var app=angular.module("app",["localytics.directives","ngRoute","route-segment","view-segment"]);app.config(function($routeSegmentProvider,$routeProvider){function isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)}$routeSegmentProvider.when("/intro","intro").when("/main","main").when("/desktop","desktop").when("/desktop/overview","main.desktop.overview").when("/desktop/bookkeeping/:mode/:id?","main.desktop.bookkeeping").when("/desktop/invoices","main.desktop.invoiceOverview").when("/desktop/invoices/new","main.desktop.invoiceDetails").when("/desktop/invoices/:mode/:id","main.desktop.invoiceDetails").when("/desktop/book","main.desktop.book").when("/desktop/raw","main.desktop.raw").when("/desktop/moms","main.desktop.reportMoms").when("/desktop/test","main.desktop.test").when("/desktop/resultat","main.desktop.reportResultat").when("/desktop/balans","main.desktop.reportBalans").when("/desktop/ne","main.desktop.reportNe").when("/desktop/autokontera","main.desktop.reportAutoKontera").when("/desktop/settings","main.desktop.moreSettings").when("/desktop/sie","main.desktop.moreSie").when("/mobile","main.mobile").segment("intro",{templateUrl:"/html/page/intro.html",controller:"introCtrl"}).segment("main",{templateUrl:"/html/page/main.html",controller:"mainCtrl",resolve:{login:function($user){return $user.whenLoginFinished()}},untilResolved:{templateUrl:"/html/page/loader.html"},resolveFailed:{templateUrl:"",controller:function($location){$location.path("/intro")}}}).within().segment("desktop",{"default":!isMobile(),templateUrl:"/html/page/nav.html"}).within().segment("overview",{"default":!0,templateUrl:"/html/page/overview.html",controller:"overviewCtrl"}).segment("bookkeeping",{templateUrl:"/html/page/bookkeeping.html",controller:"bookkeepingCtrl",dependencies:["id","mode"]}).segment("test",{templateUrl:"/html/page/test.html",controller:"testCtrl"}).segment("invoiceOverview",{templateUrl:"/html/page/invOverview.html",controller:"invOverviewCtrl"}).segment("invoiceDetails",{templateUrl:"/html/page/invoice.html",controller:"invoiceCtrl"}).segment("reportMoms",{templateUrl:"/html/page/moms.html",controller:"momsCtrl"}).segment("raw",{templateUrl:"/html/page/raw.html",controller:"rawCtrl"}).segment("book",{templateUrl:"/html/page/book.html",controller:"bookCtrl"}).segment("reportResultat",{templateUrl:"/html/page/resultat.html",controller:"resultatCtrl"}).segment("reportBalans",{templateUrl:"/html/page/balans.html",controller:"balansCtrl"}).segment("reportNe",{templateUrl:"/html/page/ne.html",controller:"neCtrl"}).segment("reportAutoKontera",{templateUrl:"/html/page/autokontera.html",controller:"autokonteraCtrl"}).segment("moreSettings",{templateUrl:"/html/page/settings.html",controller:"settingCtrl"}).segment("moreSie",{templateUrl:"/html/page/sie.html",controller:"sieCtrl"}).up().segment("mobile",{"default":isMobile(),templateUrl:"/html/page/mobile.html",controller:"mobileCtrl"}),$routeProvider.otherwise({redirectTo:"/main"})}).run(function($http,$templateCache,$rootScope,$location,$user){$user.login();var page=["/html/page/main.html","/html/page/balans.html","/html/page/book.html","/html/page/bookkeeping.html","/html/page/test.html","/html/page/dropbox.html","/html/page/intro.html","/html/page/invoice.html","/html/page/invOverview.html","/html/page/mobile.html","/html/page/moms.html","/html/page/nav.html","/html/page/ne.html","/html/page/autokontera.html","/html/page/overview.html","/html/page/raw.html","/html/page/reports.html","/html/page/resultat.html","/html/page/settings.html","/html/page/sie.html","/html/mpage/avslut.html","/html/mpage/hem.html","/html/mpage/inbet.html","/html/mpage/nav.html","/html/mpage/navOversikt.html","/html/mpage/overforing.html","/html/mpage/oversikt.html","/html/mpage/rapporter.html","/html/mpage/utbet.html","/html/partials/datepicker.html","/html/partials/dropboxImage.html","/html/partials/error.html","/html/partials/paginator.html","/html/partials/panel.html","/html/partials/sortable.html"];page.forEach(function(p){$http.get(p).then(function(res){$templateCache.put(p,res.data)})})});var app=angular.module("app");app.service("dbMock",function(){function indexById(id){for(var i=0;i<poster.length;i++)if(poster[i].id===id)return i;return-1}var self=this,nil=function(){},poster=[];self.sendToDb=nil,self.logout=nil,self.delete=function(post){poster=_.reject(poster,function(p){return post.id===p.id})},self.deleteAll=function(){poster=[]};var id=0;self.add=function(post){post.id=++id+"",poster.push({typ:post.etikett,text:JSON.stringify(post)})},self.update=function(post){delete post.$$hashKey;var index=indexById(post.id);index>=0&&(poster[index]=post)},self.get=function(){return _.map(poster,function(l){var p=angular.fromJson(l.text);return p.id=l.id,p})},self.haveUser=function(){return!0}});var app=angular.module("app");app.service("dbService",function($http,$util,$q){var datastore,client=new Dropbox.Client({key:"24nnxqff25hbfqu"});this.remoteAuth=function(){client.authenticate()},this.getEmail=function(){var deferred=$q.defer();return client.getAccountInfo(function(error,info){deferred.resolve(info.email)}),deferred.promise},this.logout=function(){client.signOff()},this.localAuth=function(){var deferred=$q.defer();if(client.authenticate({interactive:!1},function(error){error&&alert("Authentication error: "+error)}),client.isAuthenticated()){var datastoreManager=client.getDatastoreManager();datastoreManager.openDefaultDatastore(function(error,ds){error?alert("Error opening default datastore: "+error):(datastore=ds,deferred.resolve(!0))})}else deferred.reject("no local login");return deferred.promise},this.isAuth=function(){return client.isAuthenticated()},this.delete=function(post){var taskTable=datastore.getTable("user"),list=taskTable.query();_.each(list,function(l){post.id==l.getId()&&l.deleteRecord()})},this.deleteAll=function(){var taskTable=datastore.getTable("user"),list=taskTable.query();_.each(list,function(l){l.deleteRecord()})},this.add=function(post){var taskTable=datastore.getTable("user"),inserted=taskTable.insert({typ:post.etikett,text:JSON.stringify(post)});post.id=inserted.getId()},this.update=function(post){var taskTable=datastore.getTable("user");delete post.$$hashKey,taskTable.get(post.id).update({typ:post.etikett,text:JSON.stringify(post)})},this.get=function(){var taskTable=datastore.getTable("user"),list=taskTable.query(),poster=[];return _.each(list,function(l){var p=angular.fromJson(l.get("text"));p.id=l.getId(),poster.push(p)}),poster}});var app=angular.module("app");app.service("$defaultData",function($http,$util){this.info=[{etikett:"info",version:1,momsperiod:[{pay:!1,name:"Hel år"}],moms:[{konto:"2611",typ:"25",checked:!0},{konto:"2621",typ:"12",checked:!1},{konto:"2631",typ:"6",checked:!1},{konto:"0",typ:"0",checked:!1}],aktiv:0,hideSerie:!0,series:[{namn:"M",info:"Manuell"},{namn:"A",info:"Automatisk"}]},{etikett:"rar","årsnr":"0",start:$util.getSieYearStart(),slut:$util.getSieYearEnd()},{etikett:"flagga",x:"1"},{etikett:"format",PC8:"PC8"},{etikett:"sietyp"},{etikett:"program",programnamn:"Eboxen",version:"1.00"},{etikett:"gen"},{etikett:"fnamn","företagsnamn":"Ledgerbox"},{etikett:"logo",src:"data:image/png;base64,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"},{etikett:"orgnr",orgnr:"555555-5555"},{etikett:"adress",kontakt:"Lars Carlsson",utdelningsadr:"Götgatan 1",postadr:"4733",tel:"070-2225551"},{etikett:"kptyp",typ:"EUBAS97"},{etikett:"valuta",valutakod:"SEK"}],this.allKonton=[{etikett:"konto",kontonr:"1110",kontonamn:"Byggnader"},{etikett:"konto",kontonr:"1119",kontonamn:"Ackumulerade avskrivningar på byggnader"},{etikett:"konto",kontonr:"1130",kontonamn:"Mark"},{etikett:"konto",kontonr:"1210",kontonamn:"Maskiner och andra tekniska anläggningar"},{etikett:"konto",kontonr:"1211",kontonamn:"Maskiner"},{etikett:"konto",kontonr:"1213",kontonamn:"Andra tekniska anläggningar"},{etikett:"konto",kontonr:"1219",kontonamn:"Ackumulerade avskrivningar på maskiner och andra tekniska anläggningar"},{etikett:"konto",kontonr:"1220",kontonamn:"Inventarier och verktyg"},{etikett:"konto",kontonr:"1229",kontonamn:"Ackumulerade avskrivningar på inventarier och verktyg"},{etikett:"konto",kontonr:"1240",kontonamn:"Bilar och andra transportmedel"},{etikett:"konto",kontonr:"1249",kontonamn:"Ackumulerade avskrivningar på bilar och andra transportmedel"},{etikett:"konto",kontonr:"1250",kontonamn:"Datorer"},{etikett:"konto",kontonr:"1259",kontonamn:"Ackumulerade avskrivningar på datorer"},{etikett:"konto",kontonr:"1290",kontonamn:"Övriga materiella anläggningstillgångar"},{etikett:"konto",kontonr:"1291",kontonamn:"Konst och liknande tillgångar"},{etikett:"konto",kontonr:"1299",kontonamn:"Ackumulerade avskrivningar på övriga materiella anläggningstillgångar"},{etikett:"konto",kontonr:"1410",kontonamn:"Lager av råvaror"},{etikett:"konto",kontonr:"1419",kontonamn:"Förändring av lager av råvaror"},{etikett:"konto",kontonr:"1440",kontonamn:"Produkter i arbete"},{etikett:"konto",kontonr:"1449",kontonamn:"Förändring av produkter i arbete"},{etikett:"konto",kontonr:"1450",kontonamn:"Lager av färdiga varor"},{etikett:"konto",kontonr:"1459",kontonamn:"Förändring av lager av färdiga varor"},{etikett:"konto",kontonr:"1460",kontonamn:"Lager av handelsvaror"},{etikett:"konto",kontonr:"1469",kontonamn:"Förändring av lager av handelsvaror"},{etikett:"konto",kontonr:"1470",kontonamn:"Pågående arbeten"},{etikett:"konto",kontonr:"1471",kontonamn:"Pågående arbeten, nedlagda kostnader"},{etikett:"konto",kontonr:"1478",kontonamn:"Pågående arbeten, fakturering"},{etikett:"konto",kontonr:"1479",kontonamn:"Förändring av pågående arbeten"},{etikett:"konto",kontonr:"1510",kontonamn:"Kundfordringar"},{etikett:"konto",kontonr:"1512",kontonamn:"Belånade kundfordringar (factoring)"},{etikett:"konto",kontonr:"1515",kontonamn:"Osäkra kundfordringar"},{etikett:"konto",kontonr:"1516",kontonamn:"Tvistiga kundfordringar"},{etikett:"konto",kontonr:"1518",kontonamn:"Ej reskontraförda kundfordringar"},{etikett:"konto",kontonr:"1519",kontonamn:"Nedskrivning av kundfordringar"},{etikett:"konto",kontonr:"1610",kontonamn:"Kortfristiga fordringar hos anställda"},{etikett:"konto",kontonr:"1630",kontonamn:"Avräkning för skatter och avgifter (skattekonto)"},{etikett:"konto",kontonr:"1640",kontonamn:"Skattefordringar"},{etikett:"konto",kontonr:"1650",kontonamn:"Momsfordran"},{etikett:"konto",kontonr:"1680",kontonamn:"Andra kortfristiga fordringar"},{etikett:"konto",kontonr:"1684",kontonamn:"Kortfristiga fordringar hos leverantörer"},{etikett:"konto",kontonr:"1710",kontonamn:"Förutbetalda hyreskostnader"},{etikett:"konto",kontonr:"1790",kontonamn:"Övriga förutbetalda kostnader och upplupna intäkter"},{etikett:"konto",kontonr:"1910",kontonamn:"Kassa"},{etikett:"konto",kontonr:"1920",kontonamn:"PlusGiro"},{etikett:"konto",kontonr:"1930",kontonamn:"Företagskonto/checkkonto/affärskonto"},{etikett:"konto",kontonr:"1940",kontonamn:"Övriga bankkonton"},{etikett:"konto",kontonr:"2010",kontonamn:"Eget kapital, delägare 1"},{etikett:"konto",kontonr:"2013",kontonamn:"Övriga egna uttag"},{etikett:"konto",kontonr:"2018",kontonamn:"Övriga egna insättningar"},{etikett:"konto",kontonr:"2050",kontonamn:"Avsättning till expansionsfond"},{etikett:"konto",kontonr:"2081",kontonamn:"Aktiekapital"},{etikett:"konto",kontonr:"2085",kontonamn:"Uppskrivningsfond"},{etikett:"konto",kontonr:"2086",kontonamn:"Reservfond"},{etikett:"konto",kontonr:"2091",kontonamn:"Balanserad vinst eller förlust"},{etikett:"konto",kontonr:"2092",kontonamn:"Mottagna/lämnade koncernbidrag"},{etikett:"konto",kontonr:"2093",kontonamn:"Erhållna aktieägartillskott"},{etikett:"konto",kontonr:"2098",kontonamn:"Vinst eller förlust från föregående år"},{etikett:"konto",kontonr:"2099",kontonamn:"Årets resultat"},{etikett:"konto",kontonr:"2110",kontonamn:"Periodiseringsfonder"},{etikett:"konto",kontonr:"2110",kontonamn:"Periodiseringsfond vid 2010 års taxering"},{etikett:"konto",kontonr:"2111",kontonamn:"Periodiseringsfond vid 2011 års taxering"},{etikett:"konto",kontonr:"2112",kontonamn:"Periodiseringsfond vid 2012 års taxering"},{etikett:"konto",kontonr:"2113",kontonamn:"Periodiseringsfond vid 2013 års taxering"},{etikett:"konto",kontonr:"2123",kontonamn:"Periodiseringsfond 2013"},{etikett:"konto",kontonr:"2124",kontonamn:"Periodiseringsfond 2014"},{etikett:"konto",kontonr:"2125",kontonamn:"Periodiseringsfond 2015"},{etikett:"konto",kontonr:"2126",kontonamn:"Periodiseringsfond 2016"},{etikett:"konto",kontonr:"2127",kontonamn:"Periodiseringsfond 2017"},{etikett:"konto",kontonr:"2128",kontonamn:"Periodiseringsfond vid 2008 års taxering"},{etikett:"konto",kontonr:"2129",kontonamn:"Periodiseringsfond vid 2009 års taxering"},{etikett:"konto",kontonr:"2150",kontonamn:"Ackumulerade överavskrivningar"},{etikett:"konto",kontonr:"2152",kontonamn:"Ackumulerade överavskrivningar på byggnader och markanläggningar"},{etikett:"konto",kontonr:"2153",kontonamn:"Ackumulerade överavskrivningar på maskiner och inventarier"},{etikett:"konto",kontonr:"2330",kontonamn:"Checkräkningskredit"},{etikett:"konto",kontonr:"2351",kontonamn:"Fastighetslån, långfristig del"},{etikett:"konto",kontonr:"2355",kontonamn:"Långfristiga lån i utländsk valuta från kreditinstitut"},{etikett:"konto",kontonr:"2359",kontonamn:"Övriga långfristiga lån från kreditinstitut"},{etikett:"konto",kontonr:"2340",kontonamn:"Byggnadskreditiv"},{etikett:"konto",kontonr:"2350",kontonamn:"Andra långfristiga skulder till kreditinstitut"},{etikett:"konto",kontonr:"2390",kontonamn:"Övriga långfristiga skulder"},{etikett:"konto",kontonr:"2411",kontonamn:"Kortfristiga lån från kreditinstitut"},{etikett:"konto",kontonr:"2417",kontonamn:"Kortfristig del av långfristiga skulder till kreditinstitut"},{etikett:"konto",kontonr:"2419",kontonamn:"Övriga kortfristiga skulder till kreditinstitut"},{etikett:"konto",kontonr:"2420",kontonamn:"Förskott från kunder"},{etikett:"konto",kontonr:"2421",kontonamn:"Ej inlösta presentkort"},{etikett:"konto",kontonr:"2429",kontonamn:"Övriga förskott från kunder"},{etikett:"konto",kontonr:"2440",kontonamn:"Leverantörsskulder"},{etikett:"konto",kontonr:"2445",kontonamn:"Tvistiga leverantörsskulder"},{etikett:"konto",kontonr:"2448",kontonamn:"Ej reskontraförda leverantörsskulder"},{etikett:"konto",kontonr:"2450",kontonamn:"Fakturerad men ej upparbetad intäkt"},{etikett:"konto",kontonr:"2480",kontonamn:"Checkräkningskredit, kortfristig"},{etikett:"konto",kontonr:"2490",kontonamn:"Övriga kortfristiga skulder till kreditinstitut, kunder och leverantörer"},{etikett:"konto",kontonr:"2510",kontonamn:"Skatteskulder"},{etikett:"konto",kontonr:"2513",kontonamn:"Beräknad fastighetsskatt/fastighetsavgift"},{etikett:"konto",kontonr:"2514",kontonamn:"Beräknad särskild löneskatt på pensionskostnader"},{etikett:"konto",kontonr:"2515",kontonamn:"Beräknad avkastningsskatt"},{etikett:"konto",kontonr:"2611",kontonamn:"Utgående moms på försäljning inom Sverige, 25 %"},{etikett:"konto",kontonr:"2614",kontonamn:"Beräknad utgående moms på tjänsteförvärv från utlandet, 25 %"},{etikett:"konto",kontonr:"2615",kontonamn:"Beräknad utgående moms på varuförvärv från annat EU-land, 25 %"},{etikett:"konto",kontonr:"2617",kontonamn:"Utgående moms omvänd skattskyldighet varor och tjänster i Sverige, 25 %"},{etikett:"konto",kontonr:"2621",kontonamn:"Utgående moms på försäljning inom Sverige, 12 %"},{etikett:"konto",kontonr:"2631",kontonamn:"Utgående moms på försäljning inom Sverige, 6 %"},{etikett:"konto",kontonr:"2641",kontonamn:"Debiterad ingående moms"},{etikett:"konto",kontonr:"2645",kontonamn:"Beräknad ingående moms på förvärv från utlandet"},{etikett:"konto",kontonr:"2647",kontonamn:"Ingående moms omvänd skattskyldighet varor och tjänster i Sverige"},{etikett:"konto",kontonr:"2650",kontonamn:"Redovisningskonto för moms"},{etikett:"konto",kontonr:"2710",kontonamn:"Personalskatt"},{etikett:"konto",kontonr:"2731",kontonamn:"Avräkning lagstadgade sociala avgifter"},{etikett:"konto",kontonr:"2732",kontonamn:"Avräkning särskild löneskatt"},{etikett:"konto",kontonr:"2799",kontonamn:"Övriga löneavdrag"},{etikett:"konto",kontonr:"2820",kontonamn:"Kortfristiga skulder till anställda"},{etikett:"konto",kontonr:"2849",kontonamn:"Övriga kortfristiga låneskulder"},{etikett:"konto",kontonr:"2899",kontonamn:"Övriga kortfristiga skulder"},{etikett:"konto",kontonr:"2910",kontonamn:"Upplupna löner"},{etikett:"konto",kontonr:"2920",kontonamn:"Upplupna semesterlöner"},{etikett:"konto",kontonr:"2940",kontonamn:"Upplupna lagstadgade sociala och andra avgifter"},{etikett:"konto",kontonr:"2960",kontonamn:"Upplupna räntekostnader"},{etikett:"konto",kontonr:"2970",kontonamn:"Förutbetalda intäkter"},{etikett:"konto",kontonr:"2990",kontonamn:"Övriga upplupna kostnader och förutbetalda intäkter"},{etikett:"konto",kontonr:"3041",kontonamn:"Försäljning av tjänster inom Sverige, moms 25 %"},{etikett:"konto",kontonr:"3042",kontonamn:"Försäljning av tjänster inom Sverige, moms 12 %"},{etikett:"konto",kontonr:"3043",kontonamn:"Försäljning av tjänster inom Sverige, moms 6 %"},{etikett:"konto",kontonr:"3044",kontonamn:"Försäljning av tjänster inom Sverige, momsfri"},{etikett:"konto",kontonr:"3045",kontonamn:"Försäljning av tjänster till land utanför EU"},{etikett:"konto",kontonr:"3048",kontonamn:"Försäljning av tjänster till annat EU-land, momsfri"},{etikett:"konto",kontonr:"3051",kontonamn:"Försäljning av varor inom Sverige, moms 25 %"},{etikett:"konto",kontonr:"3052",kontonamn:"Försäljning av varor inom Sverige, moms 12 %"},{etikett:"konto",kontonr:"3053",kontonamn:"Försäljning av varor inom Sverige, moms 6 %"},{etikett:"konto",kontonr:"3054",kontonamn:"Försäljning av varor inom Sverige, momsfri"},{etikett:"konto",kontonr:"3055",kontonamn:"Försäljning av varor till land utanför EU"},{etikett:"konto",kontonr:"3058",kontonamn:"Försäljning av varor till annat EU-land, momsfri"},{etikett:"konto",kontonr:"3231",kontonamn:"Försäljning inom byggsektorn, omvänd skattskyldighet moms"},{etikett:"konto",kontonr:"3510",kontonamn:"Fakturerat emballage"},{etikett:"konto",kontonr:"3520",kontonamn:"Fakturerade frakter"},{etikett:"konto",kontonr:"3540",kontonamn:"Faktureringsavgifter"},{etikett:"konto",kontonr:"3550",kontonamn:"Fakturerade resekostnader"},{etikett:"konto",kontonr:"3590",kontonamn:"Övriga fakturerade kostnader"},{etikett:"konto",kontonr:"3610",kontonamn:"Försäljning av material"},{etikett:"konto",kontonr:"3620",kontonamn:"Tillfällig uthyrning av personal"},{etikett:"konto",kontonr:"3630",kontonamn:"Tillfällig uthyrning av transportmedel"},{etikett:"konto",kontonr:"3670",kontonamn:"Intäkter från värdepapper"},{etikett:"konto",kontonr:"3690",kontonamn:"Övriga sidointäkter"},{etikett:"konto",kontonr:"3730",kontonamn:"Lämnade rabatter"},{etikett:"konto",kontonr:"3731",kontonamn:"Lämnade kassarabatter"},{etikett:"konto",kontonr:"3732",kontonamn:"Lämnade mängdrabatter"},{etikett:"konto",kontonr:"3740",kontonamn:"Öres- och kronutjämning"},{etikett:"konto",kontonr:"3750",kontonamn:"Punktskatter"},{etikett:"konto",kontonr:"3790",kontonamn:"Övriga intäktskorrigeringar"},{etikett:"konto",kontonr:"3910",kontonamn:"Hyres- och arrendeintäkter"},{etikett:"konto",kontonr:"3950",kontonamn:"Återvunna, tidigare avskrivna kundfordringar"},{etikett:"konto",kontonr:"3960",kontonamn:"Valutakursvinster på fordringar och skulder av rörelsekaraktär"},{etikett:"konto",kontonr:"3970",kontonamn:"Vinst vid avyttring av immateriella och materiella anläggningstillgångar"},{etikett:"konto",kontonr:"3980",kontonamn:"Erhållna offentliga stöd m.m."},{etikett:"konto",kontonr:"3990",kontonamn:"Övriga ersättningar och intäkter"},{etikett:"konto",kontonr:"3994",kontonamn:"Försäkringsersättningar"},{etikett:"konto",kontonr:"3999",kontonamn:"Övriga rörelseintäkter"},{etikett:"konto",kontonr:"4010",kontonamn:"Inköp av varor och material inom Sverige"},{etikett:"konto",kontonr:"4051",kontonamn:"Inköp av varor och material från land utanför EU"},{etikett:"konto",kontonr:"4056",kontonamn:"Inköp av varor från annat EU-land, moms 25 %"},{etikett:"konto",kontonr:"4058",kontonamn:"Inköp av varor från annat EU-land, momsfri"},{etikett:"konto",kontonr:"4600",kontonamn:"Legoarbeten och underentreprenader (gruppkonto)"},{etikett:"konto",kontonr:"4700",kontonamn:"Reduktion av inköpspriser (gruppkonto)"},{etikett:"konto",kontonr:"4730",kontonamn:"Erhållna rabatter"},{etikett:"konto",kontonr:"4731",kontonamn:"Erhållna kassarabatter"},{etikett:"konto",kontonr:"4732",kontonamn:"Erhållna mängdrabatter (inkl. bonus)"},{etikett:"konto",kontonr:"4790",kontonamn:"Övriga reduktioner av inköpspriser"},{etikett:"konto",kontonr:"4900",kontonamn:"Förändring av lager (gruppkonto)"},{etikett:"konto",kontonr:"4910",kontonamn:"Förändring av lager av råvaror"},{etikett:"konto",kontonr:"4940",kontonamn:"Förändring av produkter i arbete"},{etikett:"konto",kontonr:"4950",kontonamn:"Förändring av lager av färdiga varor"},{etikett:"konto",kontonr:"4960",kontonamn:"Förändring av lager av handelsvaror"},{etikett:"konto",kontonr:"4990",kontonamn:"Förändring av lager och pågående arbeten (ofördelad)"},{etikett:"konto",kontonr:"5000",kontonamn:"Lokalkostnader (gruppkonto)"},{etikett:"konto",kontonr:"5010",kontonamn:"Lokalhyra"},{etikett:"konto",kontonr:"5020",kontonamn:"El för belysning"},{etikett:"konto",kontonr:"5030",kontonamn:"Värme"},{etikett:"konto",kontonr:"5040",kontonamn:"Vatten och avlopp"},{etikett:"konto",kontonr:"5050",kontonamn:"Lokaltillbehör"},{etikett:"konto",kontonr:"5060",kontonamn:"Städning och renhållning"},{etikett:"konto",kontonr:"5061",kontonamn:"Städning"},{etikett:"konto",kontonr:"5062",kontonamn:"Sophämtning"},{etikett:"konto",kontonr:"5063",kontonamn:"Hyra för sopcontainer"},{etikett:"konto",kontonr:"5064",kontonamn:"Snöröjning"},{etikett:"konto",kontonr:"5065",kontonamn:"Trädgårdsskötsel"},{etikett:"konto",kontonr:"5070",kontonamn:"Reparation och underhåll av lokaler"},{etikett:"konto",kontonr:"5090",kontonamn:"Övriga lokalkostnader"},{etikett:"konto",kontonr:"5100",kontonamn:"Fastighetskostnader (gruppkonto)"},{etikett:"konto",kontonr:"5110",kontonamn:"Tomträttsavgäld/arrende"},{etikett:"konto",kontonr:"5120",kontonamn:"El för belysning"},{etikett:"konto",kontonr:"5130",kontonamn:"Värme"},{etikett:"konto",kontonr:"5131",kontonamn:"Uppvärmning"},{etikett:"konto",kontonr:"5132",kontonamn:"Sotning"},{etikett:"konto",kontonr:"5140",kontonamn:"Vatten och avlopp"},{etikett:"konto",kontonr:"5160",kontonamn:"Städning och renhållning"},{etikett:"konto",kontonr:"5161",kontonamn:"Städning"},{etikett:"konto",kontonr:"5162",kontonamn:"Sophämtning"},{etikett:"konto",kontonr:"5163",kontonamn:"Hyra för sopcontainer"},{etikett:"konto",kontonr:"5164",kontonamn:"Snöröjning"},{etikett:"konto",kontonr:"5165",kontonamn:"Trädgårdsskötsel"},{etikett:"konto",kontonr:"5170",kontonamn:"Reparation och underhåll av fastighet"},{etikett:"konto",kontonr:"5190",kontonamn:"Övriga fastighetskostnader"},{etikett:"konto",kontonr:"5191",kontonamn:"Fastighetsskatt/fastighetsavgift"},{etikett:"konto",kontonr:"5192",kontonamn:"Fastighetsförsäkringspremier"},{etikett:"konto",kontonr:"5193",kontonamn:"Fastighetsskötsel och förvaltning"},{etikett:"konto",kontonr:"5200",kontonamn:"Hyra av anläggningstillgångar (gruppkonto)"},{etikett:"konto",kontonr:"5210",kontonamn:"Hyra av maskiner och andra tekniska anläggningar"},{etikett:"konto",kontonr:"5220",kontonamn:"Hyra av inventarier och verktyg"},{etikett:"konto",kontonr:"5250",kontonamn:"Hyra av datorer"},{etikett:"konto",kontonr:"5290",kontonamn:"Övriga hyreskostnader för anläggningstillgångar"},{etikett:"konto",kontonr:"5400",kontonamn:"Förbrukningsinventarier och förbrukningsmaterial (gruppkonto)"},{etikett:"konto",kontonr:"5410",kontonamn:"Förbrukningsinventarier"},{etikett:"konto",kontonr:"5420",kontonamn:"Programvaror"},{etikett:"konto",kontonr:"5440",kontonamn:"Förbrukningsemballage"},{etikett:"konto",kontonr:"5460",kontonamn:"Förbrukningsmaterial"},{etikett:"konto",kontonr:"5480",kontonamn:"Arbetskläder och skyddsmaterial"},{etikett:"konto",kontonr:"5490",kontonamn:"Övriga förbrukningsinventarier och förbrukningsmaterial"},{etikett:"konto",kontonr:"5500",kontonamn:"Reparation och underhåll (gruppkonto)"},{etikett:"konto",kontonr:"5510",kontonamn:"Reparation och underhåll av maskiner och andra tekniska anläggningar"},{etikett:"konto",kontonr:"5520",kontonamn:"Reparation och underhåll av inventarier, verktyg och datorer m.m."},{etikett:"konto",kontonr:"5580",kontonamn:"Underhåll och tvätt av arbetskläder"},{etikett:"konto",kontonr:"5590",kontonamn:"Övriga kostnader för reparation och underhåll"},{etikett:"konto",kontonr:"5600",kontonamn:"Kostnader för transportmedel (gruppkonto)"},{etikett:"konto",kontonr:"5610",kontonamn:"Personbilskostnader"},{etikett:"konto",kontonr:"5611",kontonamn:"Drivmedel för personbilar"},{etikett:"konto",kontonr:"5612",kontonamn:"Försäkring och skatt för personbilar"},{etikett:"konto",kontonr:"5613",kontonamn:"Reparation och underhåll av personbilar"},{etikett:"konto",kontonr:"5615",kontonamn:"Leasing av personbilar"},{etikett:"konto",kontonr:"5616",kontonamn:"Trängselskatt, avdragsgill"},{etikett:"konto",kontonr:"5619",kontonamn:"Övriga personbilskostnader"},{etikett:"konto",kontonr:"5620",kontonamn:"Lastbilskostnader"},{etikett:"konto",kontonr:"5690",kontonamn:"Övriga kostnader för transportmedel"},{etikett:"konto",kontonr:"5700",kontonamn:"Frakter och transporter (gruppkonto)"},{etikett:"konto",kontonr:"5710",kontonamn:"Frakter, transporter och försäkringar vid varudistribution"},{etikett:"konto",kontonr:"5730",kontonamn:"Arbetstransporter"},{etikett:"konto",kontonr:"5790",kontonamn:"Övriga kostnader för frakter och transporter"},{etikett:"konto",kontonr:"5800",kontonamn:"Resekostnader (gruppkonto)"},{etikett:"konto",kontonr:"5810",kontonamn:"Biljetter"},{etikett:"konto",kontonr:"5820",kontonamn:"Hyrbilskostnader"},{etikett:"konto",kontonr:"5830",kontonamn:"Kost och logi"},{etikett:"konto",kontonr:"5890",kontonamn:"Övriga resekostnader"},{etikett:"konto",kontonr:"5900",kontonamn:"Reklam och PR (gruppkonto)"},{etikett:"konto",kontonr:"5910",kontonamn:"Annonsering"},{etikett:"konto",kontonr:"5930",kontonamn:"Reklamtrycksaker och direktreklam"},{etikett:"konto",kontonr:"5940",kontonamn:"Utställningar och mässor"},{etikett:"konto",kontonr:"5950",kontonamn:"Butiksreklam och återförsäljarreklam"},{etikett:"konto",kontonr:"5960",kontonamn:"Varuprover, reklamgåvor, presentreklam och tävlingar"},{etikett:"konto",kontonr:"5970",kontonamn:"Film-, radio-, TV- och Internetreklam"},{etikett:"konto",kontonr:"5980",kontonamn:"PR, institutionell reklam och sponsring"},{etikett:"konto",kontonr:"5990",kontonamn:"Övriga kostnader för reklam och PR"},{etikett:"konto",kontonr:"6000",kontonamn:"Övriga försäljningskostnader (gruppkonto)"},{etikett:"konto",kontonr:"6010",kontonamn:"Kataloger, prislistor m.m."},{etikett:"konto",kontonr:"6061",kontonamn:"Kreditupplysning"},{etikett:"konto",kontonr:"6062",kontonamn:"Inkasso och KFM-avgifter"},{etikett:"konto",kontonr:"6070",kontonamn:"Representation"},{etikett:"konto",kontonr:"6071",kontonamn:"Representation, avdragsgill"},{etikett:"konto",kontonr:"6072",kontonamn:"Representation, ej avdragsgill"},{etikett:"konto",kontonr:"6090",kontonamn:"Övriga försäljningskostnader"},{etikett:"konto",kontonr:"6100",kontonamn:"Kontorsmateriel och trycksaker (gruppkonto)"},{etikett:"konto",kontonr:"6110",kontonamn:"Kontorsmateriel"},{etikett:"konto",kontonr:"6200",kontonamn:"Tele och post (gruppkonto)"},{etikett:"konto",kontonr:"6211",kontonamn:"Fast telefoni"},{etikett:"konto",kontonr:"6212",kontonamn:"Mobiltelefon"},{etikett:"konto",kontonr:"6230",kontonamn:"Datakommunikation"},{etikett:"konto",kontonr:"6250",kontonamn:"Postbefordran"},{etikett:"konto",kontonr:"6300",kontonamn:"Företagsförsäkringar och övriga riskkostnader (gruppkonto)"},{etikett:"konto",kontonr:"6310",kontonamn:"Företagsförsäkringar"},{etikett:"konto",kontonr:"6350",kontonamn:"Förluster på kundfordringar"},{etikett:"konto",kontonr:"6351",kontonamn:"Konstaterade förluster på kundfordringar"},{etikett:"konto",kontonr:"6352",kontonamn:"Befarade förluster på kundfordringar"},{etikett:"konto",kontonr:"6370",kontonamn:"Kostnader för bevakning och larm"},{etikett:"konto",kontonr:"6400",kontonamn:"Förvaltningskostnader (gruppkonto)"},{etikett:"konto",kontonr:"6420",kontonamn:"Ersättningar till revisor"},{etikett:"konto",kontonr:"6440",kontonamn:"Årsredovisning och delårsrapporter"},{etikett:"konto",kontonr:"6490",kontonamn:"Övriga förvaltningskostnader"},{etikett:"konto",kontonr:"6500",kontonamn:"Övriga externa tjänster (gruppkonto)"},{etikett:"konto",kontonr:"6530",kontonamn:"Redovisningstjänster"},{etikett:"konto",kontonr:"6540",kontonamn:"IT-tjänster"},{etikett:"konto",kontonr:"6550",kontonamn:"Konsultarvoden"},{etikett:"konto",kontonr:"6560",kontonamn:"Serviceavgifter till branschorganisationer"},{etikett:"konto",kontonr:"6570",kontonamn:"Bankkostnader"},{etikett:"konto",kontonr:"6580",kontonamn:"Advokat- och rättegångskostnader"},{etikett:"konto",kontonr:"6590",kontonamn:"Övriga externa tjänster"},{etikett:"konto",kontonr:"6800",kontonamn:"Inhyrd personal (gruppkonto)"},{etikett:"konto",kontonr:"6810",kontonamn:"Inhyrd produktionspersonal"},{etikett:"konto",kontonr:"6820",kontonamn:"Inhyrd lagerpersonal"},{etikett:"konto",kontonr:"6830",kontonamn:"Inhyrd transportpersonal"},{etikett:"konto",kontonr:"6840",kontonamn:"Inhyrd kontors- och ekonomipersonal"},{etikett:"konto",kontonr:"6850",kontonamn:"Inhyrd IT-personal"},{etikett:"konto",kontonr:"6860",kontonamn:"Inhyrd marknads- och försäljningspersonal"},{etikett:"konto",kontonr:"6870",kontonamn:"Inhyrd restaurang- och butikspersonal"},{etikett:"konto",kontonr:"6880",kontonamn:"Inhyrda företagsledare"},{etikett:"konto",kontonr:"6890",kontonamn:"Övrig inhyrd personal"},{etikett:"konto",kontonr:"6900",kontonamn:"Övriga externa kostnader (gruppkonto)"},{etikett:"konto",kontonr:"6910",kontonamn:"Licensavgifter och royalties"},{etikett:"konto",kontonr:"6930",kontonamn:"Kostnader för varumärken m.m."},{etikett:"konto",kontonr:"6940",kontonamn:"Kontroll-, provnings- och stämpelavgifter"},{etikett:"konto",kontonr:"6970",kontonamn:"Tidningar, tidskrifter och facklitteratur"},{etikett:"konto",kontonr:"6980",kontonamn:"Föreningsavgifter"},{etikett:"konto",kontonr:"6981",kontonamn:"Föreningsavgifter, avdragsgilla"},{etikett:"konto",kontonr:"6982",kontonamn:"Föreningsavgifter, ej avdragsgilla"},{etikett:"konto",kontonr:"6990",kontonamn:"Övriga externa kostnader"},{etikett:"konto",kontonr:"6991",kontonamn:"Övriga externa kostnader, avdragsgilla"},{etikett:"konto",kontonr:"6992",kontonamn:"Övriga externa kostnader, ej avdragsgilla"},{etikett:"konto",kontonr:"6993",kontonamn:"Lämnade bidrag och gåvor"},{etikett:"konto",kontonr:"7010",kontonamn:"Löner till kollektivanställda"},{etikett:"konto",kontonr:"7090",kontonamn:"Förändring av semesterlöneskuld"},{etikett:"konto",kontonr:"7210",kontonamn:"Löner till tjänstemän"},{etikett:"konto",kontonr:"7220",kontonamn:"Löner till företagsledare"},{etikett:"konto",kontonr:"7290",kontonamn:"Förändring av semesterlöneskuld"},{etikett:"konto",kontonr:"7313",kontonamn:"Ersättningar för/bidrag till bostadskostnader"},{etikett:"konto",kontonr:"7321",kontonamn:"Skattefria traktamenten, Sverige"},{etikett:"konto",kontonr:"7322",kontonamn:"Skattepliktiga traktamenten, Sverige"},{etikett:"konto",kontonr:"7323",kontonamn:"Skattefria traktamenten, utlandet"},{etikett:"konto",kontonr:"7324",kontonamn:"Skattepliktiga traktamenten, utlandet"},{etikett:"konto",kontonr:"7331",kontonamn:"Skattefria bilersättningar"},{etikett:"konto",kontonr:"7332",kontonamn:"Skattepliktiga bilersättningar"},{etikett:"konto",kontonr:"7380",kontonamn:"Kostnader för förmåner till anställda"},{etikett:"konto",kontonr:"7390",kontonamn:"Övriga kostnadsersättningar och förmåner"},{etikett:"konto",kontonr:"7400",kontonamn:"Pensionskostnader (gruppkonto)"},{etikett:"konto",kontonr:"7410",kontonamn:"Pensionsförsäkringspremier"},{etikett:"konto",kontonr:"7411",kontonamn:"Premier för kollektiva pensionsförsäkringar"},{etikett:"konto",kontonr:"7412",kontonamn:"Premier för individuella pensionsförsäkringar"},{etikett:"konto",kontonr:"7490",kontonamn:"Övriga pensionskostnader"},{etikett:"konto",kontonr:"7500",kontonamn:"Sociala och andra avgifter enligt lag och avtal (gruppkonto)"},{etikett:"konto",kontonr:"7510",kontonamn:"Lagstadgade sociala avgifter"},{etikett:"konto",kontonr:"7519",kontonamn:"Sociala avgifter för semester- och löneskulder"},{etikett:"konto",kontonr:"7530",kontonamn:"Särskild löneskatt"},{etikett:"konto",kontonr:"7533",kontonamn:"Särskild löneskatt för pensionskostnader"},{etikett:"konto",kontonr:"7550",kontonamn:"Avkastningsskatt på pensionsmedel"},{etikett:"konto",kontonr:"7580",kontonamn:"Gruppförsäkringspremier"},{etikett:"konto",kontonr:"7581",kontonamn:"Grupplivförsäkringspremier"},{etikett:"konto",kontonr:"7582",kontonamn:"Gruppsjukförsäkringspremier"},{etikett:"konto",kontonr:"7583",kontonamn:"Gruppolycksfallsförsäkringspremier"},{etikett:"konto",kontonr:"7600",kontonamn:"Övriga personalkostnader (gruppkonto)"},{etikett:"konto",kontonr:"7610",kontonamn:"Utbildning"},{etikett:"konto",kontonr:"7620",kontonamn:"Sjuk- och hälsovård"},{etikett:"konto",kontonr:"7621",kontonamn:"Sjuk- och hälsovård, avdragsgill"},{etikett:"konto",kontonr:"7622",kontonamn:"Sjuk- och hälsovård, ej avdragsgill"},{etikett:"konto",kontonr:"7623",kontonamn:"Sjukvårdsförsäkring, ej avdragsgill"},{etikett:"konto",kontonr:"7631",kontonamn:"Personalrepresentation, avdragsgill"},{etikett:"konto",kontonr:"7632",kontonamn:"Personalrepresentation, ej avdragsgill"},{etikett:"konto",kontonr:"7690",kontonamn:"Övriga personalkostnader"},{etikett:"konto",kontonr:"7691",kontonamn:"Personalrekrytering"},{etikett:"konto",kontonr:"7820",kontonamn:"Avskrivningar på byggnader och markanläggningar"},{etikett:"konto",kontonr:"7821",kontonamn:"Avskrivningar på byggnader"},{etikett:"konto",kontonr:"7824",kontonamn:"Avskrivningar på markanläggningar"},{etikett:"konto",kontonr:"7830",kontonamn:"Avskrivningar på maskiner och inventarier"},{etikett:"konto",kontonr:"7831",kontonamn:"Avskrivningar på maskiner och andra tekniska anläggningar"},{etikett:"konto",kontonr:"7832",kontonamn:"Avskrivningar på inventarier och verktyg"},{etikett:"konto",kontonr:"7834",kontonamn:"Avskrivningar på bilar och andra transportmedel"},{etikett:"konto",kontonr:"7835",kontonamn:"Avskrivningar på datorer"},{etikett:"konto",kontonr:"7839",kontonamn:"Avskrivningar på övriga maskiner och inventarier"},{etikett:"konto",kontonr:"7960",kontonamn:"Valutakursförluster på fordringar och skulder av rörelsekaraktär"},{etikett:"konto",kontonr:"7970",kontonamn:"Förlust vid avyttring av immateriella och materiella anläggningstillgångar"},{etikett:"konto",kontonr:"7990",kontonamn:"Övriga rörelsekostnader"},{etikett:"konto",kontonr:"7972",kontonamn:"Förlust vid avyttring av byggnader och mark"},{etikett:"konto",kontonr:"7973",kontonamn:"Förlust vid avyttring av maskiner och inventarier"},{etikett:"konto",kontonr:"8210",kontonamn:"Utdelningar på andelar i andra företag"},{etikett:"konto",kontonr:"8212",kontonamn:"Utdelningar, övriga företag"},{etikett:"konto",kontonr:"8220",kontonamn:"Resultat vid försäljning av värdepapper i och långfristiga fordringar hos andra företag"},{etikett:"konto",kontonr:"8221",kontonamn:"Resultat vid försäljning av andelar i andra företag"},{etikett:"konto",kontonr:"8222",kontonamn:"Resultat vid försäljning av långfristiga fordringar hos andra företag"},{etikett:"konto",kontonr:"8230",kontonamn:"Valutakursdifferenser på långfristiga fordringar"},{etikett:"konto",kontonr:"8231",kontonamn:"Valutakursvinster på långfristiga fordringar"},{etikett:"konto",kontonr:"8236",kontonamn:"Valutakursförluster på långfristiga fordringar"},{etikett:"konto",kontonr:"8250",kontonamn:"Ränteintäkter från långfristiga fordringar hos och värdepapper i andra företag"},{etikett:"konto",kontonr:"8251",kontonamn:"Ränteintäkter från långfristiga fordringar"},{etikett:"konto",kontonr:"8252",kontonamn:"Ränteintäkter från övriga värdepapper"},{etikett:"konto",kontonr:"8310",kontonamn:"Ränteintäkter från omsättningstillgångar"},{etikett:"konto",kontonr:"8311",kontonamn:"Ränteintäkter från bank"},{etikett:"konto",kontonr:"8312",kontonamn:"Ränteintäkter från kortfristiga placeringar"},{etikett:"konto",kontonr:"8313",kontonamn:"Ränteintäkter från kortfristiga fordringar"},{etikett:"konto",kontonr:"8314",kontonamn:"Skattefria ränteintäkter"},{etikett:"konto",kontonr:"8319",kontonamn:"Övriga ränteintäkter från omsättningstillgångar"},{etikett:"konto",kontonr:"8330",kontonamn:"Valutakursdifferenser på kortfristiga fordringar och placeringar"},{etikett:"konto",kontonr:"8331",kontonamn:"Valutakursvinster på kortfristiga fordringar och placeringar"},{etikett:"konto",kontonr:"8336",kontonamn:"Valutakursförluster på kortfristiga fordringar och placeringar"},{etikett:"konto",kontonr:"8340",kontonamn:"Utdelningar på kortfristiga placeringar"},{etikett:"konto",kontonr:"8350",kontonamn:"Resultat vid försäljning av kortfristiga placeringar"},{etikett:"konto",kontonr:"8390",kontonamn:"Övriga finansiella intäkter"},{etikett:"konto",kontonr:"8400",kontonamn:"Räntekostnader (gruppkonto)"},{etikett:"konto",kontonr:"8410",kontonamn:"Räntekostnader för långfristiga skulder"},{etikett:"konto",kontonr:"8413",kontonamn:"Räntekostnader för checkräkningskredit"},{etikett:"konto",kontonr:"8415",kontonamn:"Räntekostnader för andra skulder till kreditinstitut"},{etikett:"konto",kontonr:"8419",kontonamn:"Övriga räntekostnader för långfristiga skulder"},{etikett:"konto",kontonr:"8420",kontonamn:"Räntekostnader för kortfristiga skulder"},{etikett:"konto",kontonr:"8421",kontonamn:"Räntekostnader till kreditinstitut"},{etikett:"konto",kontonr:"8422",kontonamn:"Dröjsmålsräntor för leverantörsskulder"},{etikett:"konto",kontonr:"8423",kontonamn:"Räntekostnader för skatter och avgifter"},{etikett:"konto",kontonr:"8429",kontonamn:"Övriga räntekostnader för kortfristiga skulder"},{etikett:"konto",kontonr:"8430",kontonamn:"Valutakursdifferenser på skulder"},{etikett:"konto",kontonr:"8431",kontonamn:"Valutakursvinster på skulder"},{etikett:"konto",kontonr:"8436",kontonamn:"Valutakursförluster på skulder"},{etikett:"konto",kontonr:"8440",kontonamn:"Erhållna räntebidrag"},{etikett:"konto",kontonr:"8710",kontonamn:"Extraordinära intäkter"},{etikett:"konto",kontonr:"8750",kontonamn:"Extraordinära kostnader"},{etikett:"konto",kontonr:"8810",kontonamn:"Förändring av periodiseringsfond"},{etikett:"konto",kontonr:"8811",kontonamn:"Avsättning till periodiseringsfond"},{etikett:"konto",kontonr:"8819",kontonamn:"Återföring från periodiseringsfond"},{etikett:"konto",kontonr:"8820",kontonamn:"Mottagna koncernbidrag"},{etikett:"konto",kontonr:"8830",kontonamn:"Lämnade koncernbidrag"},{etikett:"konto",kontonr:"8850",kontonamn:"Förändring av överavskrivningar"},{etikett:"konto",kontonr:"8910",kontonamn:"Skatt som belastar årets resultat"},{etikett:"konto",kontonr:"8920",kontonamn:"Skatt på grund av ändrad beskattning"},{etikett:"konto",kontonr:"8980",kontonamn:"Övriga skatter"},{etikett:"konto",kontonr:"8990",kontonamn:"Resultat"},{etikett:"konto",kontonr:"8999",kontonamn:"Årets resultat"}]
}),angular.module("app").factory("dropboxChooser",function($q){return function(options){var deferred=$q.defer();return options.success=deferred.resolve,options.cancel=deferred.reject,Dropbox.choose(options),deferred.promise}}),angular.module("app").factory("ddInvoice",["$log","$q","pdfMake",function($log,$q,pm){function QrCode(inv,companyData){function UQRDate(d){return d.replace(/\-/g,"")}var uqr={uqr:1,tp:1,nme:companyData.fnamn,cid:companyData.orgnr,iref:inv.num,idt:UQRDate(inv.date),ddt:UQRDate(inv.maturity),due:inv.toBePaid.toFixed(),vat:inv.totalVAT.toFixed(),pt:companyData.pt,acc:companyData.acc};return console.log(JSON.stringify(uqr)),{qr:JSON.stringify(uqr),alignment:"right",fit:90,margin:[0,20,0,0]}}function header(inv,companyData){var hdr={table:{widths:["*",220],body:[],margin:[0,0,0,8]},layout:pm.emptyLayout},body=hdr.table.body;return body.push([pm.stack([pm.image(companyData.logo,{fit:[75,75]}),pm.st(companyData.fname||"[FNAME]","h1"),pm.box(pm.columns([{text:"Referens:\nDröjsmålsränta: "},inv.ref+"\n"+inv.penaltyInterest],{style:"nr"}),{margin:[0,5,4,4]})]),pm.stack([pm.box(pm.columns([pm.st("Faktura","h1"),pm.text("",{width:"*"}),pm.vOffset(pm.st("Nummer "+inv.num,"h2"),5)]),{margin:[0,0,0,4]},"#eee"),pm.columns([pm.box([pm.st("Fakturadatum","nr","em"),pm.st(inv.date,"nr","em")],{margin:[0,0,0,4]},"#eee"),pm.text("",{width:10}),pm.box([pm.st("Förfallotdatum","nr"),pm.st(inv.maturity,"nr")],{margin:[0,0,0,4]},"#eee")],{alignment:"center"}),pm.box(pm.stack([inv.customer.name,inv.customer.address," ",inv.customer.street+" "+inv.customer.city," "],{style:"nr",margin:[0,0,0,11]}))])]),hdr}function lines(inv){var layout={hLineWidth:function(row,node){return 2>row||row===node.table.body.length?1:0},vLineWidth:function(col,node){return 0===col||col===node.table.body[0].length?1:0}},lines={table:{widths:["*","auto","auto","auto","auto"],body:[]},layout:layout},body=lines.table.body;body.push([pm.st("Text","nr","em"),pm.st("Antal","nr","em","right"),pm.st("À-pris","nr","em","right"),pm.st("Pris exkl. moms","nr","em","right"),pm.st("Momssats","nr","em","right")]);var i=0;for(i=0;i<inv.lines.length;i++){var line=inv.lines[i];body.push([pm.st(line.text,"nr"),pm.st(pm.cc(line.qty,0),"nr","right"),pm.st(pm.cc(line.unitPrice),"nr","right"),pm.st(pm.cc(line.priceExclTax),"nr","right"),pm.st(pm.pct(line.VATRate),"nr","right")])}for(;10>i;)body.push([pm.text("x",{color:"#fff"}),pm.text(""),pm.text(""),pm.text(""),pm.text("")]),i++;return lines}function VATGroups(inv){var node={table:{widths:[30,50,30,40,50],body:[]},layout:pm.boxLayout},body=node.table.body;body.push([pm.text("Momsspecifikation",{style:["sm","em"],colSpan:5}),pm.text(""),pm.text(""),pm.text(""),pm.text("")]),body.push([pm.st("\nMoms","sm"),pm.st("Pris\nexkl moms","sm","right"),pm.st("Moms\ni kr","sm","right"),pm.st("Öresav-\nrundning","sm","right"),pm.st("Summa","sm","right")]);for(var i=0;i<inv.VATGroups.length;i++){var vg=inv.VATGroups[i];body.push([pm.st(pm.pct(vg.VATRate),"sm"),pm.st(pm.cc(vg.priceExclTax,0),"nr","right","em"),pm.st(pm.cc(vg.VAT,0),"nr","right","em"),pm.st(vg.rounding?pm.cc(vg.rounding):"","nr","right","em"),pm.st(pm.cc(vg.total,0),"nr","right","em")])}return node}function summary(inv){var node={table:{widths:[200,"*",90],body:[]},layout:pm.emptyLayout,margin:[0,4,0,0]},body=node.table.body;return body.push([VATGroups(inv),{text:"",width:"*"},pm.box(pm.stack([pm.text("Att betala",{fontSize:11,bold:!0,alignment:"right"}),pm.text(pm.cc(inv.toBePaid,0)+" kr",{fontSize:11,alignment:"right"})],{margin:[10,0,0,21]}),{},"#eee")]),node}function footer(companyData){function h(text){return pm.st(text||"","sm","em")}function b(text){return pm.st(text||"","sm")}var node={table:{widths:[150,"auto","auto","*"],body:[]},layout:pm.boxLayout,margin:[0,20,0,0]},body=node.table.body;return body.push([h("Adressupgifter"),h("Telefon"),h("E-post/webbplats"),pm.st("Godkänd för F-skatt",["sm","em","right"])]),body.push([b((companyData.fname||"")+"\n"+(companyData.utdelningsadr||"")+"\n"+(companyData.ort||"")),b(companyData.tel),b((companyData.epost||"")+"\n"+(companyData.web||"")),pm.text("")]),body.push([pm.text(""),h("Momsreg.nr"),h("Bankgiro"),pm.text("")]),body.push([pm.text(""),b(companyData.orgnr),b(companyData.acc),pm.text("")]),node}function getDd(invoice,companyData){var dd={styles:styles,pageMargins:[72,72,72,72],paperSize:"A4",content:[]};return dd.content.push(header(invoice,companyData)),dd.content.push(lines(invoice)),dd.content.push(summary(invoice)),dd.content.push(QrCode(invoice,companyData)),dd.content.push(footer(companyData)),dd}var styles={h1:{fontSize:16,bold:!0},h2:{fontSize:11,bold:!0},nr:{fontSize:9},sm:{fontSize:8},em:{bold:!0},right:{alignment:"right"}};return function(inv,companyData){var deferred=$q.defer(),dd=getDd(inv,companyData);return pm.printer.createPdf(dd).getDataUrl(function(result){result?deferred.resolve(result):($log.error("Error genereating PDF s Data Url for document definition"),deferred.reject("No Data Url"))}),deferred.promise}}]);var app=angular.module("app");app.service("$manager",function($http,$util,$q,$timeout,$user,$log,$location,parserService){this.login=function(){return $user.login()},this.logout=function(){$user.logout(),$location.path("/intro")},this.isAuth=function(){return $user.login()},this.getSieFile=function(book){var list=$user.getHeader(book);return list=list.concat($user.getKonton()),list=list.concat($user.getVerByBook(book)),parserService.jsonToSie(list)},this.uploadSie=function(res){var file=$util.sieToString(res),json=parserService.sieToJson(file),rar=_.findWhere(json.poster,{etikett:"rar"}),balanser=_.where(json.poster,{etikett:"ib"}),ver=_.where(json.poster,{etikett:"ver"}),info=$user.getInfo();$util.addSeries(ver,info),$user.update(info);$user.createBook(rar.start,rar.slut,balanser,ver)},this.createNewBook=function(start,end,balances){var balanser=[];_.each(balances,function(b){var post={etikett:"IB","årsnr":0,kontonr:b.konto,saldo:b.saldo};balanser.push(post)}),$user.createBook(start,end,balanser,[])},this.getBooks=function(){return $user.getBooks()}});var app=angular.module("app");app.service("$mobile",function($http,$filter,$util,$q,$user){var self=this;this.kassakonton=[{konto:"1941",text:"Plusgiro"},{konto:"1940",text:"Bankgiro"},{konto:"1960",text:"Kassa"},{konto:"2160",text:"Eget utlägg"}],this.intyp=[{kontotext:"Försäljning",konto:"3010"},{kontotext:"Övriga inkomster",konto:"3900"}],this.uttyp=[{kategori:"normal",kontotext:"Varuinköp",konto:"4000",isMoms:!0,tooltip:"Varor för försäljning."},{kategori:"normal",kontotext:"Hyra",konto:"5010",isMoms:!0,tooltip:""},{kategori:"normal",kontotext:"Förbrukningsinventarier",konto:"5410",isMoms:!0,tooltip:"Datorer, möbler, skrivare mm."},{kategori:"normal",kontotext:"Förbrukningsmaterial",konto:"5460",isMoms:!0,tooltip:"Kontorsmaterial, rengöring mm"},{kategori:"normal",kontotext:"Biljetter",konto:"5810",isMoms:!0,tooltip:"T ex taxi, tåg, flyg, buss, parkering mm. "},{kategori:"normal",kontotext:"Kost och logi",konto:"5830",isMoms:!0,tooltip:"Hotell och liknande."},{kategori:"normal",kontotext:"Reklam och PR",konto:"5900",isMoms:!0,tooltip:"Annonsering, tryckt reklam, reklamgåvora. "},{kategori:"Representation",kontotext:"Representation",konto:"6071",tooltip:"Måste fördelas på olika konton. "},{kategori:"normal",kontotext:"Tele och post",konto:"6200",isMoms:!0,tooltip:"Fast telefon, mobiltelefon, internet, post. "},{kategori:"normal",kontotext:"Försäkringar",konto:"6310",isMoms:!0,tooltip:"Företagsförsäkringar. "},{kategori:"normal",kontotext:"Redovisningstjänster",konto:"6540",isMoms:!0,tooltip:"Annonsering, tryckt reklam, reklamgåvora. "},{kategori:"normal",kontotext:"IT-tjänster",konto:"6550",isMoms:!0,tooltip:"Webb-hotell, IT-konsulter mm. "},{kategori:"normal",kontotext:"Konsultarvoden",konto:"6570",isMoms:!0,tooltip:"Inhyrd personal. "},{kategori:"normal",kontotext:"Bankkostnader",konto:"7600",isMoms:!1,tooltip:"Kostnader för bank och plusgiro."},{kategori:"normal",kontotext:"Övriga personalkostnader",konto:"7600",isMoms:!0,tooltip:"Fika, träningskort (ej lön)."},{kategori:"normal",kontotext:"Ränteintäkter",konto:"8300",isMoms:!1,tooltip:" "},{kategori:"normal",kontotext:"Räntekostnader",konto:"8400",isMoms:!1,tooltip:" "}],this.undo=function(){$user.undo()},this.inbet=function(p){"Försäljning"==p.typ.kontotext?this.forsalj(p):"Övriga inkomster"==p.typ.kontotext?this.ovrigInkomst(p):"Ränteinkomst"==p.typ.kontotext&&this.ranteinkomst(p)},this.utbet=function(p){"normal"==p.typ.kategori?this.utbetNormal(p):"Representation"==p.typ.kategori&&this.representation(p)},this.getNewPayment=function(){var payment={};return payment.moms=$user.getInfo().moms,payment.date=new Date,payment},this.overforing=function(p){var ver={};ver.etikett="ver",ver.verdatum=$util.dateToSie(new Date(p.date)),ver.vernr=$user.getNextNr(),ver.vertext=p.text,ver.poster=[],ver.poster.push({etikett:"trans",kontonr:p.till.konto,belopp:parseFloat(p.belopp)}),ver.poster.push({etikett:"trans",kontonr:p.fran.konto,belopp:-parseFloat(p.belopp)}),$user.addVer(ver)},this.oversikt=function(){var res=[];return _.each($user.getVer(),function(v){var extra={};extra.typ=self.getTypNamn(v),extra.date=new Date($filter("siedate")(v.verdatum)).getTime(),extra.dateString=$util.sieToDate(v.verdatum),extra.vernr=parseInt(v.vernr),extra.files=$util.getVerNameFiles(v.vertext),extra.text=$util.getVerNameText(v.vertext),extra.sum=$util.sumBelopp(v),extra.sumFixed=$util.toFixed(extra.sum),extra.ver=v,res.push(extra)}),res},this.getTypNamn=function(v,types){var k1,k2,types=this.uttyp.concat(this.intyp),namn="Okänd",count=0;return _.each(v.poster,function(p){var typ=_.findWhere(types,{konto:p.kontonr});typ&&(namn=typ.kontotext);var kassakonto=_.findWhere(self.kassakonton,{konto:p.kontonr});kassakonto&&(count++,p.belopp<0?k1=kassakonto.text:k2=kassakonto.text)}),2==count?"("+k1+" till "+k2+")":namn},this.utbetNormal=function(p){var ver={};ver.etikett="ver",ver.verdatum=$util.dateToSie(new Date(p.date)),ver.vernr=$user.getNextNr(),ver.vertext=p.typ.text+$util.getArryToPipe(p.files),ver.poster=[];var sum=0;p.typ.isMoms?(sum=p.typ.belopp-p.typ.moms,ver.poster.push({etikett:"trans",kontonr:"2641",belopp:p.typ.moms})):sum=p.typ.belopp,ver.poster.push({etikett:"trans",kontonr:p.typ.konto,belopp:sum}),ver.poster.push({etikett:"trans",kontonr:p.konto,belopp:-p.typ.belopp}),$user.addVer(ver)},this.repAvdrag=function(p){if(p.reptyp){var repAntal=$util.stringToNr(p.repAntal),repBelopp=$util.stringToNr(p.repBelopp),repMoms=$util.stringToNr(p.repMoms),reptyp=$util.stringToNr(p.reptyp);p.repAvdrag=Math.min(repBelopp,90*repAntal),p.repAvdragMoms=$util.stringToNr(Math.min(p.repAvdrag*reptyp,repMoms)),p.repNoAvdrag=$util.stringToNr(Math.max(0,p.repBelopp-(p.repAvdrag+p.repAvdragMoms)))}},this.representation=function(p){var ver={};ver.etikett="ver",ver.verdatum=$util.dateToSie(new Date(p.date)),ver.vernr=$user.getNextNr(),ver.vertext=p.typ.text+$util.getArryToPipe(p.files),ver.poster=[];ver.poster.push({etikett:"trans",kontonr:"2641",belopp:p.repAvdragMoms}),ver.poster.push({etikett:"trans",kontonr:"6071",belopp:p.repAvdrag}),p.repNoAvdrag&&ver.poster.push({etikett:"trans",kontonr:"6072",belopp:p.repNoAvdrag}),ver.poster.push({etikett:"trans",kontonr:p.konto,belopp:-p.typ.belopp}),$user.addVer(ver)},this.forsalj=function(p){var ver={};ver.etikett="ver",ver.verdatum=$util.dateToSie(new Date(p.date)),ver.vernr=$user.getNextNr(),ver.vertext=p.text+$util.getArryToPipe(p.files),ver.poster=[];var sum=0,sum_moms=0;_.each(p.moms,function(m){m.moms&&(ver.poster.push({etikett:"trans",kontonr:m.konto,belopp:-m.moms}),sum+=parseFloat(m.belopp),sum_moms+=parseFloat(m.moms))}),ver.poster.push({etikett:"trans",kontonr:"3010",belopp:-sum}),ver.poster.push({etikett:"trans",kontonr:p.konto,belopp:sum+sum_moms}),$user.addVer(ver)},this.ovrigInkomst=function(p){var ver={};ver.etikett="ver",ver.verdatum=$util.dateToSie(new Date(p.date)),ver.vernr=$user.getNextNr(),ver.vertext=p.text+$util.getArryToPipe(p.files),ver.poster=[],ver.poster.push({etikett:"trans",kontonr:"2611",belopp:parseFloat(p.moms)}),ver.poster.push({etikett:"trans",kontonr:"3900",belopp:parseFloat(p.belopp)}),ver.poster.push({etikett:"trans",kontonr:p.konto,belopp:parseFloat(p.moms)+parseFloat(p.belopp)}),$user.addVer(ver)},this.ranteinkomst=function(p){var ver={};ver.etikett="ver",ver.verdatum=$util.dateToSie(new Date(p.date)),ver.vernr=$user.getNextNr(),ver.vertext=p.text,ver.poster=[],ver.poster.push({etikett:"trans",kontonr:"1940",belopp:p.belopp+p.skatt}),ver.poster.push({etikett:"trans",kontonr:"3010",belopp:p.belopp}),ver.poster.push({etikett:"trans",kontonr:"",belopp:p.skatt}),$user.addVer(ver)}});var app=angular.module("app");app.service("parserService",function(){function dim(p){var dim="{";return _.each(p,function(d){_.each(d,function(dd){dim+=q(dd)+" "})}),dim+="} "}function q(v){return v?_.isNumber(v)?v:v.indexOf(" ")>=0?'"'+v+'"':v:""}function SieFile(){this.poster=[]}this.sieToJson=function(f){return parser.parse(f)},this.jsonToSie=function(f){var file="#";return _.each(f,function(p){_.each(p,function(v,k){"object"==typeof v?(file+="\n{\n",_.each(v,function(a){file+="	#",_.each(a,function(t,k){"object"==typeof t?file+=dim(t):("etikett"==k&&(t=t.toUpperCase()),"book"==k||(file+="belopp"==k?t.toFixed(2)+" ":""+q(t)+" "))}),file+="\n"}),file+="\n}"):("etikett"==k&&(v=v.toUpperCase()),"aktiv"==k||"id"==k||"book"==k||(file+=q(v)+" "))}),file+="\n#"}),file=file.slice(0,-1)};var parser={parse:function(sieFileData){var root=new SieFile,lines=sieFileData.split(/\r?\n/),stack=[],cur=root;for(var i in lines)cur.poster=cur.poster||[],"{"==lines[i]?(stack[stack.length]=cur,cur=cur.poster[cur.poster.length-1]):"}"==lines[i]?cur=stack.pop():lines[i].match(/\s*#/)&&(cur.poster[cur.poster.length]=parser._parseLine(lines[i].replace(/^\s*/,"").replace(/\s*$/,"")));return root},_parseLine:function(line){var tokens=parser._tokenizer(line),etikett=tokens[0].value.replace(/^#/,"").toLowerCase(),row={etikett:etikett};return parser._parseAttrs(row,tokens.slice(1))},_Tokens:{ELEMENT:"#",BEGINARRAY:"{",ENDARRAY:"}",STRING:'"',ARRAY:"{}"},_tokenizer:function(line){for(var tokens=[],consume=!1,quoted=!1,i=0;i<line.length;i++)consume?quoted?"\\"==line[i]&&i+1<line.length&&'"'==line[i+1]?tokens[tokens.length-1].value+=line[++i]:(quoted=consume='"'!=line[i],consume&&(tokens[tokens.length-1].value+=line[i])):(consume=" "!=line[i]&&"	"!=line[i]&&"}"!=line[i],consume?tokens[tokens.length-1].value+=line[i]:"}"==line[i]&&(tokens[tokens.length]={type:parser._Tokens.ENDARRAY})):"#"==line[i]?(consume=!0,tokens[tokens.length]={type:parser._Tokens.ELEMENT,value:""}):"{"==line[i]?tokens[tokens.length]={type:parser._Tokens.BEGINARRAY}:"}"==line[i]?tokens[tokens.length]={type:parser._Tokens.ENDARRAY}:'"'==line[i]?(consume=quoted=!0,tokens[tokens.length]={type:parser._Tokens.STRING,value:""}):" "!=line[i]&&"	"!=line[i]&&(consume=!0,tokens[tokens.length]={type:parser._Tokens.STRING,value:line[i]});return tokens},_parseAttrs:function(row,tokens){if(parser._Elements[row.etikett])for(var i=0;i<parser._Elements[row.etikett].length;i++)"object"==typeof parser._Elements[row.etikett][i]?(parser._parseArray(tokens,i,parser._Elements[row.etikett][i]),parser._addAttr(row,parser._Elements[row.etikett][i].name,tokens,i)):parser._addAttr(row,parser._Elements[row.etikett][i],tokens,i);return row},_parseArray:function(tokens,start,attrDef){for(var i=start+1;i<tokens.length;i++)if(tokens[i].type==parser._Tokens.ENDARRAY){tokens[start]={type:parser._Tokens.ARRAY,value:parser._valuesOnly(tokens.splice(start,i-start).slice(1))};for(var a=[],j=0;j<tokens[start].value.length-attrDef.type.length+1;j+=attrDef.type.length){for(var o={},k=0;k<attrDef.type.length;k++)o[attrDef.type[k]]=tokens[start].value[j+k];a[a.length]=o}tokens[start].value=attrDef.many?a:a[0]||null}},_addAttr:function(obj,attr,tokens,pos){pos<tokens.length&&(obj[attr]="belopp"==attr?parseFloat(tokens[pos].value):tokens[pos].value)},_valuesOnly:function(tokens){for(var va=[],i=0;i<tokens.length;i++)va[va.length]=tokens[i].value;return va},_Elements:{adress:["kontakt","utdelningsadr","postadr","tel"],bkod:["SNI-kod"],dim:["dimensionsnr","namn"],enhet:["kontonr","enhet"],flagga:["x"],fnamn:["företagsnamn"],fnr:["företagsid"],format:["PC8"],ftyp:["Företagstyp"],gen:["datum","sign"],ib:["årsnr","konto","saldo","kvantitet"],konto:["kontonr","kontonamn"],kptyp:["typ"],ktyp:["kontonr","kontotyp"],objekt:["dimensionsnr","objektnr","objektnamn"],oib:["årsnr","konto",{name:"objekt",type:["dimensionsnr","objektnr"]},"saldo","kvantitet"],omfattn:["datum"],orgnr:["orgnr","förvnr","verknr"],oub:["årsnr","konto",{name:"objekt",type:["dimensionsnr","objektnr"]},"saldo","kvantitet"],pbudget:["årsnr","period","konto",{name:"objekt",type:["dimensionsnr","objektnr"]},"saldo","kvantitet"],program:["programnamn","version"],prosa:["text"],psaldo:["årsnr","period","konto",{name:"objekt",type:["dimensionsnr","objektnr"]},"saldo","kvantitet"],rar:["årsnr","start","slut"],res:["års","konto","saldo","kvantitet"],sietyp:["typnr"],sru:["konto","SRU-kod"],taxar:["år"],trans:["kontonr",{name:"objektlista",type:["dimensionsnr","objektnr"],many:!0},"belopp","transdat","transtext","kvantitet","sign"],rtrans:["kontonr",{name:"objektlista",type:["dimensionsnr","objektnr"],many:!0},"belopp","transdat","transtext","kvantitet","sign"],btrans:["kontonr",{name:"objektlista",type:["dimensionsnr","objektnr"],many:!0},"belopp","transdat","transtext","kvantitet","sign"],ub:["årsnr","konto","saldo","kvantitet"],underdim:["dimensionsnr","namn","superdimension"],valuta:["valutakod"],ver:["serie","vernr","verdatum","vertext","regdatum","sign"]},Universal:[{etikett:"dim",dimensionsnr:"1",namn:"Kostnadsställe / resultatenhet"},{etikett:"underdim",dimensionsnr:"2",namn:"Kostnadsbärare",superdimension:"1"},{etikett:"dim",dimensionsnr:"6",namn:"Projekt"},{etikett:"dim",dimensionsnr:"7",namn:"Anställd"},{etikett:"dim",dimensionsnr:"8",namn:"Kund"},{etikett:"dim",dimensionsnr:"9",namn:"Leverantör"},{etikett:"dim",dimensionsnr:"10",namn:"Faktura"}],list:function(scan,etikett){var list=[],fel=etikett.replace(/^#/,"").toLowerCase();for(var i in scan)if(scan[i].etikett==fel){for(var add=!0,j=2;j<arguments.length-1;j+=2)add=scan[i][arguments[j]]&&scan[i][arguments[j]]==arguments[j+1];add&&(list[list.length]=scan[i])}return list}};SieFile.prototype={getKonto:function(kontonr){var klist=this.list("konto","kontonr",kontonr);if(klist.length>0){var kptlist=this.list("kptyp"),ktlist=this.list("ktyp","kontonr",kontonr),slist=this.list("sru","konto",kontonr),elist=this.list("enhet","kontonr",kontonr);return{etikett:"konto",kontonr:klist[0].kontonr,kontonamn:klist[0].kontonamn,kontoplan:kptlist.length>0?kptlist[0].typ:null,kontotyp:ktlist.length>0?ktlist[0].kontotyp:null,"SRU-kod":slist.length>0?slist[0]["SRU-kod"]:null,enhet:elist.length>0?elist[0].enhet:null}}},getDimension:function(dimensionsnr){var scan=this.poster.concat(parser.Universal),list=parser.list(scan,"underdim","dimensionsnr",dimensionsnr);return 0==list.length&&(list=parser.list(scan,"dim","dimensionsnr",dimensionsnr)),list.length>0?list[0]:void 0},getObjekt:function(dimensionsnr,objektnr,separator){var separator=separator||" ",olist=this.list("objekt","dimensionsnr",dimensionsnr,"objektnr",objektnr);if(olist.length>0){var d=this.getDimension(dimensionsnr),name=olist[0].objektnamn;if(d&&d.superdimension){var polist=this.list("objekt","dimensionsnr",d.superdimension);for(var i in polist)if(0==olist[0].objektnr.indexOf(polist[i].objektnr)){name=this.getObjekt(polist[i].dimensionsnr,polist[i].objektnr,separator).namn+separator+name;break}}return{etikett:"objekt",dimensionsnr:olist[0].dimensionsnr,objektnr:olist[0].objektnr,objektnamn:olist[0].objektnamn,namn:name}}},list:function(){var args=[];args[args.length]=this.poster;for(var i=0;i<arguments.length;i++)args[args.length]=arguments[i];return parser.list.apply(parser,args)}}}),angular.module("app").factory("pdfMake",function(){function makeEl(name){function elb(body,attrs){return attrs=attrs||{},attrs[name]=body,attrs}return elb}var pm={},els=["text","stack","columns","table","image"];pm.fnval=function(val){return function(){return val}};var fn0=function(){return 0};pm.emptyLayout={hLineWidth:fn0,vLineWidth:fn0,paddingBottom:fn0,paddingTop:fn0,paddingRight:fn0,paddingLeft:fn0},pm.boxLayout={hLineWidth:function(row,node){return 0===row||row===node.table.body.length?1:0},vLineWidth:function(col,node){return 0===col||col===node.table.body[0].length?1:0}},pm.box=function(content,tableAttrs,fill){return tableAttrs=tableAttrs||{},tableAttrs.layout=tableAttrs.layout||pm.boxLayout,content=Array.isArray(content)?{stack:content}:content,fill&&(content.fillColor=fill),pm.table({widths:["*"],body:[[content]]},tableAttrs)};for(var i=0;i<els.length;i++)pm[els[i]]=makeEl(els[i]);return pm.st=function(text,style){var res={text:text||""};return style&&(res.style=style),res},pm.vOffset=function(obj,vunits){return obj.margin=[0,vunits,0,0],obj},pm.fmtNum=function(number,decimals,dec_point,thousands_sep,isPct){var n=isFinite(+number)?+number*(isPct?100:1):0,prec=isFinite(+decimals)?Math.abs(decimals):2,sep="undefined"==typeof thousands_sep?" ":thousands_sep,dec="undefined"==typeof dec_point?",":dec_point,s="";return s=(prec?n.toFixed(prec):""+Math.round(n)).split("."),s[0].length>3&&(s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,sep)),(s[1]||"").length<prec&&(s[1]=s[1]||"",s[1]+=new Array(prec-s[1].length+1).join("0")),s.join(dec)+(isPct?"%":"")},pm.cc=function(num,prec){return pm.fmtNum(num,prec)},pm.pct=function(num){return pm.fmtNum(num,0,","," ",!0)},pm.printer=window.pdfMake,pm}),angular.module("app").factory("searchText",function(){function searchTextInObj(obj,text){for(var key in obj)if(obj.hasOwnProperty(key)){var val=obj[key];if("object"==typeof val){if(searchTextInObj(val,text))return!0}else if(val=(null!==val&&void 0!==val?val.toString():"").trim().toLowerCase(),val.indexOf(text)>=0)return!0}return!1}return searchTextInObj}),angular.module("app").service("sharedObject",function(){var data={};return{setv:function(key,value){data[key]=value},getv:function(key){var obj=data[key];return delete data[key],obj}}});var app=angular.module("app");app.service("sieService",function($http,parserService){var self=this;this.getSieFile=function(user,index){var file={};file.poster=[],file.poster=file.poster.concat(self.getSieInfo(user)),file.poster=file.poster.concat(user.books[index].info);var konton=[];return _.each(user.sie.konton,function(k){if(k.aktiv){var n=angular.copy(k);delete n.aktiv,konton.push(n)}}),file.poster=file.poster.concat(konton),file.poster=file.poster.concat(user.books[index].ver),parserService.json2sie(file)}});var app=angular.module("app");app.service("$user",function($http,$util,sieService,$defaultData,dbService,dbMock,$q){var self=this;this.update=function(post){dbService.update(post)},this.getDBmail=function(){return dbService.getEmail()},this.getVer=function(){var list=_.where(self.poster,{etikett:"ver",book:self.getInfo().aktiv});return list},this.getInvoice=function(){var list=_.where(self.poster,{etikett:"invoice",book:self.getInfo().aktiv});return list},this.getLogo=function(){var list=_.findWhere(self.poster,{etikett:"logo"});return list},this.getIB=function(){var list=_.where(self.poster,{etikett:"ib","årsnr":"0",book:self.getInfo().aktiv});return list},this.getPost=function(id){var list=_.findWhere(self.poster,{id:id});return list},this.getBook=function(){var list=_.findWhere(self.poster,{etikett:"rar",id:self.getInfo().aktiv});return list},this.getVerByBook=function(book){var list=_.where(self.poster,{etikett:"ver",book:book.id});return list},this.undo=function(){var list=_.where(self.poster,{etikett:"ver",book:self.getInfo().aktiv});self.poster.pop(),dbService.delete(list.pop())},this.deletePost=function(post){_.each(self.poster,function(p,i){p.id==post.id&&self.poster.splice(i,1)}),dbService.delete(post)},this.getNextNr=function(serie){return serie?_.where(self.poster,{etikett:"ver",serie:serie,book:self.getInfo().aktiv}).length+1:_.where(self.poster,{etikett:"ver",book:self.getInfo().aktiv}).length+1},this.getIbKonto=function(nr){var konto=_.findWhere(self.poster,{"årsnr":0,book:self.getInfo().aktiv,etikett:"ib",konto:nr});return konto},this.getKonton=function(){var list=_.where(self.poster,{etikett:"konto"});return list},this.getKontoNamn=function(k){var k=_.findWhere(self.poster,{etikett:"konto",kontonr:k});return k?k.kontonamn:"Konto namn saknas"},this.getInfo=function(){return _.findWhere(self.poster,{etikett:"info"})},this.getCompanyData=function(){var data={};return data.fname=_.findWhere(self.poster,{etikett:"fname"}.företagsnamn),data.orgnr=_.findWhere(self.poster,{etikett:"orgnr"}).orgnr,data.kontakt=_.findWhere(self.poster,{etikett:"adress"}).kontakt,data.utdelningsadr=_.findWhere(self.poster,{etikett:"adress"}).utdelningsadr,data.postadr=_.findWhere(self.poster,{etikett:"adress"}).postadr,data.tel=_.findWhere(self.poster,{etikett:"adress"}).tel,data},this.activeBook=function(book){var info=self.getInfo();info.aktiv=book.id,dbService.update(info)},this.removeBook=function(book){_.each(self.poster,function(p,i){p.id&&p.id==book.id&&(dbService.delete(p),self.poster.splice(i,1)),p.book&&p.book==book.id&&(dbService.delete(p),self.poster.splice(i,1))}),self.getInfo().aktiv==book.id&&(self.getInfo().aktiv=this.getBooks().length?this.getBooks()[0].id:"")},this.getBooks=function(){var list=_.where(self.poster,{etikett:"rar"});return list},this.getHeader=function(book){var list=[];return list.push(_.findWhere(self.poster,{etikett:"flagga"})),list.push(_.findWhere(self.poster,{etikett:"format"})),list.push(_.findWhere(self.poster,{etikett:"sietyp"})),list.push(_.findWhere(self.poster,{etikett:"program"})),list.push(_.findWhere(self.poster,{etikett:"gen"})),list.push(_.findWhere(self.poster,{etikett:"fnamn"})),list.push(_.findWhere(self.poster,{etikett:"orgnr"})),list.push(_.findWhere(self.poster,{etikett:"adress"})),list.push(book),list.push(_.findWhere(self.poster,{etikett:"kptyp"})),list},this.getSumKonton=function(kontonr){var sum=0;return _.each(self.active,function(p){"ver"==p.etikett&&_.each(p.poster,function(ap){ap.kontonr==kontonr&&(sum+=parseInt(ap.belopp))})}),sum},this.addVer=function(ver){ver.book=self.getInfo().aktiv,ver.etikett="ver",self.poster.push(ver),dbService.add(ver)},this.addInvoice=function(inv){inv.book=self.getInfo().aktiv,inv.etikett="invoice",self.poster.push(inv),dbService.add(inv)},this.updateInvoice=function(inv){inv.book=self.getInfo().aktiv;for(var i=0;i<self.poster.length;i++)if(self.poster[i].id===inv.id)return self.poster[i]=inv,void dbService.update(inv)},this.removeInvoice=function(inv){self.deletePost(inv)},this.addKonto=function(k){self.poster.push(k),dbService.add(k)},this.createUser=function(){return self.poster=$defaultData.info,self.poster=self.poster.concat($defaultData.allKonton),_.each(self.poster,function(p){dbService.add(p)}),this.activeBook(this.getBooks()[0]),dbService.get()},this.createBook=function(start,end,balanser,ver){var info=self.getInfo(),rar={etikett:"rar","årsnr":"0",start:start,slut:end};return dbService.add(rar),self.poster.push(rar),_.each(balanser,function(b){b.book=rar.id,dbService.add(b),self.poster.push(b)}),_.each(ver,function(v){v.book=rar.id,dbService.add(v),self.poster.push(v)}),info.aktiv=rar.id,dbService.update(info),rar},this.logout=function(){dbService.logout()};var isDemo=!1;this.mockDB=function(){isDemo=!0,dbService=dbMock},this.login=function(){function init(status){if(status){var poster=dbService.get();0==poster.length?(poster=self.createUser(),self.poster=poster):self.poster=poster}return status}return this.loginPromise=dbService.localAuth().then(init),this.loginPromise},this.whenLoginFinished=function(){return isDemo?$q.when(!0):this.loginPromise}});var app=angular.module("app");app.service("$util",function(){var self=this;this.events=[],this.errors=[],this.stringToNr=function(s){return parseFloat(s?parseFloat(s).toFixed(2):"0")},this.error=function(titel,msg){self.errors.push({titel:titel,msg:msg,status:"alert-warning"})},this.info=function(titel,msg){self.errors.pop(),self.errors.push({titel:titel,msg:msg,status:"alert-info"})},this.getServerApi=function(){return"/api/dropbox/"},this.getSieYearStart=function(){var d=new Date;return d.getFullYear().toString()+"0101"},this.getSieYearEnd=function(){var d=new Date;return d.getFullYear().toString()+"1231"},this.getKonton=function(konton){return _.where(konton,{etikett:"konto",aktiv:!0})},this.sumBelopp=function(v){var sum=0;return _.each(v.poster,function(p){p.belopp>0&&(sum+=p.belopp)}),sum},this.toFixed=function(sum){return sum.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$& ").replace(".",",")},this.getStringDate=function(d){var yyyy=d.getFullYear().toString(),mm=(d.getMonth()+1).toString(),dd=d.getDate().toString();return yyyy+"-"+(mm[1]?mm:"0"+mm[0])+"-"+(dd[1]?dd:"0"+dd[0])},this.dateToSie=function(date){var yyyy=date.getFullYear().toString(),mm=(date.getMonth()+1).toString(),dd=date.getDate().toString();return yyyy+(mm[1]?mm:"0"+mm[0])+(dd[1]?dd:"0"+dd[0])},this.sieToDate=function(sie){var stringDate=sie.substring(0,4)+"-"+sie.substring(4,6)+"-"+sie.substring(6,8);return stringDate},this.addSeries=function(ver,info){var series=_.pluck(ver,"serie");_.each(series,function(s){_.findWhere(info.series,{namn:s})||s&&info.series.push({namn:s,info:""})})},this.addKonto=function(ver,info){_.pluck(ver,"konto");_.each(konto,function(s){_.findWhere(info.series,{namn:s})||s&&info.series.push({namn:s,info:""})})},this.move=function(list,old_index,new_index){if(new_index>=list.length)for(var k=new_index-list.length;k--+1;)list.push(void 0);list.splice(new_index,0,list.splice(old_index,1)[0])},this.isMobile=function(){return window.innerWidth<=800&&window.innerHeight<=600?!0:!1};var mapUTF8="ÇüéâäàåçêëèïîìÄÅÉæÆôöòûùÿÖÜ¢£¥₧ƒáíóúñÑªº¿⌐¬½¼¡«»░▒▓│┤╡╢╖╕╣║╗╝╜╛┐└┴┬├─┼╞╟╚╔╩╦╠═╬╧╨╤╥╙╘╒╓╫╪┘┌█▄▌▐▀αßΓπΣσµτΦΘΩδ∞φε∩≡±≥≤⌠⌡÷≈°∙·√ⁿ²■";this.sieToString=function(aB){var result="",sieBuffer=new Uint8Array(aB);return _.each(sieBuffer,function(c){result+=128>c?String.fromCharCode(c):mapUTF8[c-128]}),result},this.downloadSIE=function(b){var view=$util.stringToSie($manager.getSieFile(b.book));try{var blob=new Blob([view],{type:"application/octet-stream"})}catch(e){var bb=new(window.WebKitBlobBuilder||window.MozBlobBuilder);bb.append(view);var blob=bb.getBlob("application/octet-stream")}var url=(window.webkitURL||window.URL).createObjectURL(blob);location.href=url},this.stringToSie=function(string){var result=new Uint8Array(string.length);return _.each(string,function(s,i){var charIndex=mapUTF8.indexOf(s);if(charIndex>-1)result[i]=128+charIndex;else{var c=string.charCodeAt(i);result[i]=c}}),result},this.str2ab=function(str){for(var buf=new ArrayBuffer(str.length),bufView=new Uint8Array(buf),i=0,strLen=str.length;strLen>i;i++)bufView[i]=str.charCodeAt(i);return buf},this.getArryToPipe=function(files){var ret="";if(files){ret="|";for(i in files)ret+=files[i]+"|";ret=ret.substring(0,ret.length-1)}return ret},this.getVerNameText=function(text){return text&&-1!=text.indexOf("|")?text.split("|")[0]:text},this.getVerNameFiles=function(text){if(text&&-1!=text.indexOf("|")){var arr=text.split("|");return arr.shift(),arr}return[]},this.sumKontoSpan=function(vers,start,end,span){var belopp=0;return _.each(vers,function(v){_each(v.posts,function(a){_.each(span,function(s){s.start<=a.kontonr&&s.end<=a.kontonr&&(belopp+=Math.abs(a.belopp))})})}),belopp},this.isOldBrowser=function(){var myNav=navigator.userAgent.toLowerCase(),version=-1!=myNav.indexOf("msie")?parseInt(myNav.split("msie")[1]):!1;return version?10>version?!0:!1:version}}),function(){var __indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};angular.module("localytics.directives",[]),angular.module("localytics.directives").directive("chosen",function(){var CHOSEN_OPTION_WHITELIST,NG_OPTIONS_REGEXP,isEmpty,snakeCase;
return NG_OPTIONS_REGEXP=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/,CHOSEN_OPTION_WHITELIST=["noResultsText","allowSingleDeselect","disableSearchThreshold","disableSearch","enableSplitWordSearch","inheritSelectClasses","maxSelectedOptions","placeholderTextMultiple","placeholderTextSingle","searchContains","singleBackstrokeDelete","displayDisabledOptions","displaySelectedOptions","width"],snakeCase=function(input){return input.replace(/[A-Z]/g,function($1){return"_"+$1.toLowerCase()})},isEmpty=function(value){var key;if(angular.isArray(value))return 0===value.length;if(angular.isObject(value))for(key in value)if(value.hasOwnProperty(key))return!1;return!0},{restrict:"A",require:"?ngModel",terminal:!0,link:function(scope,element,attr,ngModel){var chosen,defaultText,disableWithMessage,empty,initOrUpdate,match,options,origRender,removeEmptyMessage,startLoading,stopLoading,valuesExpr,viewWatch;return element.addClass("localytics-chosen"),options=scope.$eval(attr.chosen)||{},angular.forEach(attr,function(value,key){return __indexOf.call(CHOSEN_OPTION_WHITELIST,key)>=0?options[snakeCase(key)]=scope.$eval(value):void 0}),startLoading=function(){return element.addClass("loading").attr("disabled",!0).trigger("chosen:updated")},stopLoading=function(){return element.removeClass("loading").attr("disabled",!1).trigger("chosen:updated")},chosen=null,defaultText=null,empty=!1,initOrUpdate=function(){return chosen?element.trigger("chosen:updated"):(chosen=element.chosen(options).data("chosen"),defaultText=chosen.default_text)},removeEmptyMessage=function(){return empty=!1,element.attr("data-placeholder",defaultText)},disableWithMessage=function(){return empty=!0,element.attr("data-placeholder",chosen.results_none_found).attr("disabled",!0).trigger("chosen:updated")},ngModel?(origRender=ngModel.$render,ngModel.$render=function(){return origRender(),initOrUpdate()},attr.multiple&&(viewWatch=function(){return ngModel.$viewValue},scope.$watch(viewWatch,ngModel.$render,!0))):initOrUpdate(),attr.$observe("disabled",function(){return element.trigger("chosen:updated")}),attr.ngOptions&&ngModel?(match=attr.ngOptions.match(NG_OPTIONS_REGEXP),valuesExpr=match[7],scope.$watchCollection(valuesExpr,function(newVal){return angular.isUndefined(newVal)?startLoading():(empty&&removeEmptyMessage(),stopLoading(),isEmpty(newVal)?disableWithMessage():void 0)})):void 0}}})}.call(this),angular.module("app").directive("datagrid",function(){return{restrict:"A",controller:function($scope,$element,$attrs){this.name=$attrs.datagrid;var ns=this.ns=$scope[this.name]={};ns.predicate="",ns.reverse=!1,ns.orderBy="",ns.search={},ns.hiddenCols=[],ns.range=function(total){for(var r=[],i=0;total>i;i++)r.push(i);return i},ns.toggleSort=this.toggleSort=function(column,order){order?(ns.predicate=column,ns.reverse="-"===order):column===ns.predicate?ns.reverse=!ns.reverse:(ns.predicate=column,ns.reverse=!1),ns.orderByExp=(ns.reverse?"-":"+")+ns.predicate},ns.cssShowHide=function(cols){for(var classes=[],i=0;cols>i;i++)classes.push(ns.isColHidden(i)?"hide-"+i:"show-"+i);return classes.join(" ")},ns.isColHidden=this.isColHidden=function(column){return ns.hiddenCols.indexOf(column)>=0},ns.toggleDisplay=this.toggleDisplay=function(column,show){var index=ns.hiddenCols.indexOf(column),isHidden=index>=0;void 0===show&&(show=isHidden),show&&isHidden?ns.hiddenCols.splice(index,1):show||isHidden||ns.hiddenCols.push(column)};var paginator=this.paginator=ns.paginator={};paginator.start=paginator.numberOfPages=0,paginator.currentPage=0,paginator.pageSize=$attrs.datagridPageSize||10,paginator.paginate=function(array){return array=array||[],paginator.numberOfPages=Math.max(Math.ceil(array.length/paginator.pageSize),1),paginator.start=paginator.currentPage*paginator.pageSize,paginator.end=paginator.start+paginator.pageSize-1,paginator.data=array.slice(paginator.start,paginator.start+paginator.pageSize),paginator.data}}}}).directive("sortBy",function(){return{restrict:"A",require:"^datagrid",templateUrl:"/html/partials/sortable.html",transclude:!0,scope:{},link:function(scope,el,attrs,ctrl){scope.ns=ctrl.ns,scope.column=attrs.sortBy,attrs.defaultSort&&ctrl.toggleSort(scope.column,attrs.defaultSort),scope.toggleSort=function(){ctrl.toggleSort(scope.column)}}}}).directive("paginator",function(){return{restrict:"E",require:"^datagrid",templateUrl:"/html/partials/paginator.html",scope:{},link:function(scope,el,attrs,ctrl){scope.ns=ctrl.paginator}}}).directive("toggleColDisplay",function(){return{restrict:"A",require:"^datagrid",transclude:!0,templateUrl:"/html/partials/toggleColDisplay.html",scope:{},link:function(scope,el,attrs,ctrl){scope.ns=ctrl.ns,scope.column=parseInt(attrs.toggleColDisplay),scope.toggleDisplay=function(){ctrl.toggleDisplay(scope.column)}}}}).directive("colIndex",function(){return{restrict:"A",require:"^datagrid",link:function(scope,el,attrs){attrs.$addClass("col-"+attrs.colIndex)}}}).directive("colHide",function(){return{restrict:"A",require:"^datagrid",link:function(scope,el,attrs,ctrl){var col=parseInt(attrs.colIndex);isNaN(col)||ctrl.toggleDisplay(col,!1)}}}).filter("paginate",function(){return function(data,grid){return grid.paginate(data)}}),angular.module("app").directive("datepicker",function(){return{restrict:"E",transclude:!0,templateUrl:"/html/partials/datepicker.html",link:function(scope,el,attrs){el.find(".input-group.date").datepicker({format:attrs.dateFormat||"yyyy-mm-dd"})}}});var app=angular.module("app");app.filter("startFrom",function(){return function(input,start){return start=+start,input.slice(start)}}),app.directive("ngActive",["$animate",function($animate){return function(scope,element,attr){scope.$watch(attr.ngActive,function(value){$animate[value?"addClass":"removeClass"](element,"active")})}}]),app.directive("aDisabled",function(){return{restrict:"A",priority:-99999,link:function(scope,element,attrs){var oldNgClick=attrs.ngClick;oldNgClick&&scope.$watch(attrs.aDisabled,function(val,oldval){console.log(val),val?element.unbind("click"):oldval&&(attrs.$set("ngClick",oldNgClick),element.bind("click",function(){scope.$apply(attrs.ngClick)}))})}}}),app.directive("isDisabled",["$animate",function($animate){return function(scope,element,attr){scope.$watch(attr.isDisabled,function(value){$animate[value?"addClass":"removeClass"](element,"disabled")})}}]),app.filter("siedate",function(){return function(value){if(!value)return"";var year=value.substring(0,4),mm=value.substring(4,6),dd=value.substring(6,8);return year+"-"+mm+"-"+dd}}),app.filter("float",function(){return function(input){return input?input.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$& ").replace(".",","):""}}),app.filter("showIfPosetive",function(){return function(input){return input&&input>0?input:""}}),app.filter("showIfNegative",function(){return function(input){return input&&0>input?input:""}}),app.filter("unsafe",function($sce){return function(val){return $sce.trustAsHtml(val)}}),app.directive("uiBlur",function(){return function(scope,elem,attrs){elem.bind("blur",function(){scope.$apply(attrs.uiBlur)})}}),app.directive("format",["$filter",function(){return{require:"?ngModel",link:function(scope,elem,attrs,ctrl){ctrl&&ctrl.$parsers.unshift(function(viewValue){viewValue=viewValue||"";var plainNumber=viewValue.replace(/[^\d|\-+|\,+]/g,""),showVal=(""+plainNumber).replace(/\B(?=(\d{3})+(?!\d))/g," ");return elem.val(showVal),plainNumber.replace(",",".")})}}}]),app.directive("dropzone",function(){return{restrict:"A",link:function(scope,elem){elem.bind("drop",function(evt){evt.stopPropagation(),evt.preventDefault();for(var f,files=evt.dataTransfer.files,i=0;f=files[i];i++){var reader=new FileReader;reader.readAsArrayBuffer(f),reader.onload=function(theFile){return function(){var newFile={name:theFile.name,type:theFile.type,size:theFile.size,lastModifiedDate:theFile.lastModifiedDate};scope.addfile(newFile)}}(f)}})}}}),app.filter("sum",function(){return function(arr,item){var tot=0;return _.each(arr,function(a){tot+=a[item]}),tot}}),app.filter("kontonrFilter",function(){return function(items,start,end){var res=_.filter(items,function(item){return start<=parseInt(item.kontonr)&&parseInt(item.kontonr)<=end?!0:!1});return res}}),app.filter("kontonrSum",function(){return function(items,start,end){{var belopp=0;_.each(items,function(item){start<=parseInt(item.kontonr)&&parseInt(item.kontonr)<=end&&(belopp+=item.belopp)})}return belopp}}),app.directive("fileread",function(){return{scope:{read:"&"},link:function(scope,element){element.bind("change",function(changeEvent){var reader=new FileReader;reader.onload=function(loadEvent){scope.read({arg:loadEvent.target.result}),scope.$apply()},reader.readAsArrayBuffer(changeEvent.target.files[0])})}}}),angular.module("app").directive("dropboxImage",function($timeout,dropboxChooser){function getImdDU(URL,cb){var img=document.createElement("img");img.onload=function(){var canvas=document.createElement("canvas");canvas.width=THUMB_SIZE,canvas.height=THUMB_SIZE;var ctx=canvas.getContext("2d");ctx.drawImage(this,0,0,THUMB_SIZE,THUMB_SIZE);var du=canvas.toDataURL("image/png");cb(du)},img.crossOrigin="anonymous",img.src=URL}var THUMB_SIZE=75;return{restrict:"E",templateUrl:"/html/partials/dropboxImage.html",scope:{src:"=",title:"@"},link:function(scope){scope.chooseImage=function(){dropboxChooser({linkType:"direct",multiselect:!1,extensions:[".png",".jpg",".jpeg",".bmp"]}).then(function(files){var thumbUrl=files[0].thumbnailLink;getImdDU(thumbUrl,function(dataUrl){scope.$apply(function(){scope.src=dataUrl})})})}}}}),angular.module("app").directive("dropdown",function(){return{restrict:"E",require:"^datagrid",templateUrl:"/html/partials/dropdown.html",transclude:!0,scope:{icon:"@",title:"@"}}}),angular.module("app").directive("momsinbet",function(){return{restrict:"E",transclude:!0,templateUrl:"/html/partials/momsinbet.html"}}),angular.module("app").directive("panel",function($timeout){return{restrict:"E",transclude:!0,templateUrl:"/html/partials/panel.html",scope:{title:"@"},link:function(scope,el,attrs){scope.collapse=!1,$timeout(function(){scope.collapse=attrs.collapse})}}});var app=angular.module("app");app.controller("autokonteraCtrl",function($scope,$log,$user,$util,$http){function parseBankFile(txt,fields){var res=[],numFields=fields.length,idx=txt.indexOf(fields[0]);if(idx>=0){txt=txt.substr(idx).split("\n");for(var i=1;i<txt.length;i++){var line=txt[i];if(line&&line.trim()){if(line=line.split("	"),numFields!==line.length)return void($scope.error="Invalid bank transaction file");for(var item={},j=0;j<fields.length;j++)item[fields[j]]=line[j];res.push(item)}}return res}$scope.error="Invalid bank transaction file"}function getVerBankTrans(vers){for(var res=[],i=0,l=vers.length;l>i;i++)for(var ver=vers[i],poster=ver.poster,ii=0,ll=poster.length;ll>ii;ii++){var p=poster[ii];("1930"===p.kontonr||"1940"===p.kontonr)&&res.push({date:$util.sieToDate(ver.verdatum),kontonr:p.kontonr,name:ver.vertext,amount:p.belopp})}return res}function findMatchVer(bankTrans,vers){bankTrans.Belopp=+bankTrans.Belopp.replace(",",".").replace(/\s+/g,"");for(var i=0,l=vers.length;l>i;i++){var v=vers[i];if(bankTrans.Transdag===v.date&&bankTrans.Belopp===v.amount)return i}return-1}function matchBankTrans(transList,vers){for(var matchList=[],i=transList.length-1;i>=0;i--){var bt=transList[i],matchIndex=findMatchVer(bt,vers);matchList.push({date:bt.Transdag,acc:matchIndex>=0?vers[matchIndex]:null,bank:bt}),matchIndex>=0&&vers.splice(matchIndex,1)}for(var i=0,l=vers.length;l>i;i++){var v=vers[i];matchList.push({date:v.accDate,acc:v,bank:null})}return matchList}$log.info("init, autokonteraCtrl"),$scope.error="";var fields=["Radnr","Clnr","Kontonr","Produkt","Valuta","Bokfdag","Transdag","Valutadag","Referens","Text","Belopp","Saldo"];$scope.doDiff=function(){$http.get("/js/test/banktransaction.txt").success(function(data){var btrans=parseBankFile(data,fields),bankVers=getVerBankTrans($user.getVer());$scope.matchList=matchBankTrans(btrans,bankVers)})}});var app=angular.module("app");app.controller("balansCtrl",function($scope,$http,$location,$manager,$util,$user,$log){$log.info("init balans"),$scope.newDate=function(){$scope.result=$scope.balansRapport($scope.search.startDate,$scope.search.endDate)},$scope.balansRapport=function(start,end){var all=[],result={};result.till=[],result.cost=[];var start=new Date(start),end=new Date(end);return _.each($user.getIB(),function(p){if(!(p.kontonr>3e3)){var k={text:$user.getKontoNamn(p.konto),konto:p.konto,ing:Math.abs(p.saldo),period:0};all.push(k)}}),_.each($user.getVer(),function(v){var date=new Date($util.sieToDate(v.verdatum));_.each(v.poster,function(p){if(!(p.kontonr>3e3)){var k=_.findWhere(all,{konto:p.kontonr});k||(k={text:$user.getKontoNamn(p.kontonr),konto:p.kontonr,ing:0,period:0},all.push(k)),start>date&&(k&&(k.ing+=Math.abs(p.belopp)),k.tot+=Math.abs(p.belopp)),date>start&&end>date&&(k&&(k.period+=Math.abs(p.belopp)),k.tot+=Math.abs(p.belopp))}})}),result.tillInTot=0,result.tillPeriodTot=0,result.costInTot=0,result.costPeriodTot=0,_.each(all,function(a){a.konto<2e3?(result.till.push(a),result.tillInTot+=a.ing+a.ing,result.tillPeriodTot+=a.period):(result.cost.push(a),result.costInTot+=a.ing+a.ing,result.costPeriodTot+=a.period),a.saldo=$util.stringToNr(a.saldo)}),result},$scope.search={};var book=$user.getBook();$scope.search.startDate=$util.sieToDate(angular.copy(book.start)),$scope.search.endDate=$util.sieToDate(angular.copy(book.slut)),$scope.result=$scope.balansRapport($scope.search.startDate,$scope.search.endDate)});var app=angular.module("app");app.controller("bookCtrl",function($scope,$manager,$log,$util,$user){$log.info("init book"),$scope.showFilter=!0,$scope.showAdvFilter=!0,$scope.konton=$user.getKonton(),$scope.date={},$scope.balances=[],$scope.balances.push({}),$scope.balances.push({}),$scope.balances.push({}),$scope.balances.push({}),$scope.edit=!0,$scope.done=!1,$scope.label=function(nr,name){return nr+" ("+name+")"},$scope.save=function(){$manager.createNewBook($util.dateToSie(new Date($scope.date.startDate)),$util.dateToSie(new Date($scope.date.endDate)),$scope.balances);$scope.edit=!1,$scope.done=!0}});var app=angular.module("app");app.controller("bookkeepingCtrl",function($scope,$http,$location,$manager,$util,$user,$log,$routeSegment){$log.info("init bookkeepingCtrl"),$scope.mode={},$scope.konton=$user.getKonton(),$scope.hideSerie=$user.getInfo().hideSerie,$scope.series=$user.getInfo().series,$scope.load=function(){$scope.clear(),$scope.mode.param=$routeSegment.$routeParams.mode;var id=$routeSegment.$routeParams.id;"show"==$scope.mode.param?($scope.mode.view=!0,$scope.verification=$user.getPost(id),_.each($scope.verification.poster,function(p){_.findWhere($scope.konton,{kontonr:p.kontonr})||$scope.konton.push({kontonr:p.kontonr,kontonamn:"Okänd"}),p.belopp>0?p.debit=p.belopp:p.credit=-p.belopp})):"revert"==$scope.mode.param&&($scope.mode.view=!1,$scope.verification=angular.copy($user.getPost(id)),$scope.verification.vertext="Ny post till ver : "+$scope.verification.vernr,$scope.verification.verdatum=$util.sieToDate($scope.verification.verdatum),_.each($scope.verification.poster,function(p){_.findWhere($scope.konton,{kontonr:p.kontonr})||$scope.konton.push({kontonr:p.kontonr,kontonamn:"Okänd"}),p.belopp>0?p.credit=p.belopp:p.debit=-p.belopp})),$scope.$watch("verification",function(){$scope.sumDebit=0,$scope.sumCredit=0,$scope.form.isValid=!0;var count=0;_.each($scope.verification.poster,function(a){$scope.verification.serie||($scope.form.isValid=!1),$scope.verification.verdatum||($scope.form.isValid=!1),$scope.verification.vertext||($scope.form.isValid=!1),a.kontonr&&(count++,a.sum=$user.getSumKonton(a.kontonr)),a.debit?a.sum+=parseFloat(a.debit):a.credit&&(a.sum+=parseFloat(-a.credit)),a.debit&&($scope.sumDebit+=parseFloat(a.debit)),a.credit&&($scope.sumCredit+=parseFloat(a.credit)),(a.debit||a.credit)&&($scope.diff=$scope.sumDebit-$scope.sumCredit),a.error=a.debit&&a.credit?!0:!1}),$scope.verification.poster.length-count<2&&$scope.verification.poster.push({text:""})},!0)},$scope.label=function(nr,name){return nr+" ("+name+")"},$scope.clear=function(){$scope.verification={},$scope.verification.poster=[],$scope.verification.poster.push({text:""}),$scope.verification.poster.push({text:""}),$scope.verification.poster.push({text:""}),$scope.verification.poster.push({text:""});var date=new Date,day=date.getDate(),month=date.getMonth()+1,year=date.getFullYear();10>month&&(month="0"+month),10>day&&(day="0"+day);var today=year+"-"+month+"-"+day;$scope.verification.verdatum=today},$scope.remove=function(array,index){array.splice(index,1)},$scope.validate=function(){return 0!=$scope.diff?($util.info("","Differensen mellan debet och kredit måste vara noll"),!1):!0},$scope.save=function(){if($scope.validate()){var ver={};$scope.verification.serie&&(ver.serie=$scope.verification.serie.namn),ver.verdatum=$util.dateToSie(new XDate($scope.verification.verdatum)),ver.vernr=$user.getNextNr(ver.serie),ver.vertext=$scope.verification.vertext+$util.getArryToPipe($scope.files),ver.poster=[],_.each($scope.verification.poster,function(a){if(a.kontonr&&(a.debit||a.credit)){var p={};p.belopp=a.debit?parseFloat(a.debit):-parseFloat(a.credit),p.etikett="trans",p.kontonr=a.kontonr,(a.debit||a.credit)&&ver.poster.push(p)}}),$user.addVer(ver),$util.info("Verifikation "+ver.vertext+" är skapad"),$scope.clear()}},$scope.addFile=function(){options={success:function(files){var fs=_.pluck(files,"link");$scope.$apply(function(){$scope.files=fs})},cancel:function(){},linkType:"preview",multiselect:!0},Dropbox.choose(options)},$scope.load()});var app=angular.module("app");app.controller("dropboxCtrl",function($scope,dbService,$manager,$location,sieService,$log){$log.info("init dropboxCtrl"),$scope.load=function(){$log.info("login"),$manager.login().then(function(){$location.path("/desktop/overview")})}});var app=angular.module("app");app.controller("introCtrl",function($scope,$location,$log,$user,$manager,dbService,$util,$http){$log.info("init, introCtrl"),$scope.show={},$scope.show.create=!1,$scope.create=function(){},$scope.login=function(){dbService.isAuth()?$location.path("/main"):dbService.remoteAuth()},$scope.demo=function(){$user.mockDB(),$user.createUser(),$http.get("/js/test/sie/prova.js",{responseType:"arraybuffer"}).success(function(data){$manager.uploadSie(data),$location.path("/main")})}});var app=angular.module("app");app.controller("invOverviewCtrl",function($scope,$filter,$user,$util,$window,$location,$manager,$log,pdfMake,ddInvoice,sharedObject,searchText){$log.info("init invOverviewCtrl"),$scope.show=function(inv){sharedObject.setv(inv.id,inv),$location.path("/desktop/invoices/show/"+inv.id)},$scope.edit=function(inv){sharedObject.setv(inv.id,inv),$location.path("/desktop/invoices/edit/"+inv.id)},$scope.remove=function(v){var i=$scope.invoices.indexOf(v);i>=0&&($user.removeInvoice(v),$scope.invoices.splice(i,1))},$scope.generatePdf=function(inv){$scope.companyData=$user.getCompanyData(),$scope.companyData.logo=_.findWhere($user.poster,{etikett:"logo"}).src,ddInvoice(inv,$scope.companyData).then(function(result){$window.open(result)})},$scope.search=function(inv){var search=$scope.g.search;if(search.freeText){if(!searchText(inv,search.freeText.trim().toLowerCase()))return!1}else{var customer=search.customer?search.customer.trim().toLowerCase():"",date=new Date(inv.date);if(customer&&inv.customer.name.toLowerCase().indexOf(customer)<0)return!1;if(search.startDate&&date<new Date(search.startDate))return!1;if(search.endDate&&date>new Date(search.endDate))return!1}return!0},$scope.invoices=$user.getInvoice()}),angular.module("app").controller("invoiceLineCtrl",function($scope){function priceExclTax(){return $scope.line.qty*$scope.line.unitPrice}function VAT(){return $scope.line.priceExclTax*$scope.line.VATRate}$scope.$watch(priceExclTax,function(newValue){$scope.line.priceExclTax=newValue}),$scope.$watch(VAT,function(newValue){$scope.line.VAT=newValue})}).controller("invoiceCtrl",function($scope,$routeSegment,$util,$user,$window,sharedObject,pdfMake,ddInvoice){function VATGroups(){for(var vg={},lines=$scope.inv.lines,i=0;i<lines.length;i++){var item=lines[i],rate=item.VATRate,vgi=vg[""+rate];vgi||(vgi=vg[""+rate]={VATRate:item.VATRate,priceExclTax:0,VAT:0,rounding:0,total:0}),vgi.priceExclTax+=item.qty*item.unitPrice}var res=[];for(var k in vg){var vgii=vg[k];vgii.VAT=vgii.priceExclTax*vgii.VATRate,vgii.total=vgii.priceExclTax+vgii.VAT,res.push(vgii)}return res}function totalExlTax(){for(var total=0,lines=$scope.inv.lines,i=0;i<lines.length;i++){var item=lines[i];total+=item.qty*item.unitPrice}return total}function totalVAT(){for(var totalVAT=0,lines=$scope.inv.lines,i=0;i<lines.length;i++){var item=lines[i];totalVAT+=item.priceExclTax*item.VATRate}return totalVAT}var now=$util.getStringDate(new Date),d=new Date;d.setMonth(d.getMonth()+1);var nowPlus30=$util.getStringDate(d),faktura=_.findWhere($user.poster,{etikett:"invoice"}),fakturaNr=1;faktura&&(fakturaNr=1+faktura.length),$scope.companyData=$user.getCompanyData(),$scope.companyData.logo=_.findWhere($user.poster,{etikett:"logo"}).src,$scope.inv={},$scope.mode={},$scope.clear=function(){$scope.inv={num:fakturaNr,date:now,maturity:nowPlus30,ref:"",penaltyInterest:"",customer:{name:"",address:"",street:"",city:""},lines:[{text:"",qty:0,unitPrice:0,VATRate:.25}],VATGroups:[{VATRate:.25,priceExclTax:0,VAT:0,rounding:0,total:0}]}},$scope.addLine=function(){$scope.inv.lines.push({text:"new...",qty:0,unitPrice:0,VATRate:.25})},$scope.removeLine=function(item){var index=$scope.inv.lines.indexOf(item);index>=0&&$scope.inv.lines.splice(index,1)},$scope.generatePdf=function(){ddInvoice($scope.inv,$scope.companyData).then(function(result){$window.open(result)})},$scope.save=function(){$util.info("Invoice "+$scope.inv.num+" är skapad"),$scope.inv.id?$user.updateInvoice($scope.inv):$user.addInvoice($scope.inv),$scope.clear(),$scope.frmInv.$setPristine()},$scope.$watch("inv.lines",function(){$scope.inv.VATGroups=VATGroups(),$scope.inv.totalExlTax=totalExlTax(),$scope.inv.totalVAT=totalVAT(),$scope.inv.totalIncTax=$scope.inv.totalExlTax+$scope.inv.totalVAT,$scope.inv.toBePaid=Math.floor($scope.inv.totalIncTax)},!0);var mode=$routeSegment.$routeParams.mode,id=$routeSegment.$routeParams.id;$scope.clear(),"show"==mode?($scope.mode.view=!0,$scope.inv=sharedObject.getv(id)):"edit"==mode&&($scope.mode.view=!1,$scope.inv=angular.copy(sharedObject.getv(id)))});var app=angular.module("app");app.controller("mainCtrl",function($scope,$http,$location,$manager,$util,$log,$timeout){$log.debug("init mainCtrl"),$scope.show={},$scope.sie={},$scope.cleanError=function(){$scope.errors=0},$scope.logout=function(){$manager.logout()},$scope.removeFile=function(index){$scope.p.file.splice(index,1)},$scope.addValue=function(val){$scope.value=val},$scope.mobile=function(){$scope.show.switch="on",$timeout(function(){$location.path("/mobile")},400)},$scope.errors=$util.errors,$scope.checkbox=!0});var app=angular.module("app");app.controller("mobileCtrl",function($scope,$location,$log,$mobile,$timeout){$log.info("init, mobileCtrl"),$scope.paginator=!1,$scope.desktop=function(){$scope.show.switch="",$timeout(function(){$location.path("/desktop/overview")},400)},$scope.addFile=function(){options={success:function(files){var fs=_.pluck(files,"link");$scope.$apply(function(){$scope.p.files=fs})},cancel:function(){},linkType:"preview",multiselect:!0},Dropbox.choose(options)},$scope.clearIn=function(){$scope.p=$mobile.getNewPayment()},$scope.undoClick=function(){$mobile.undo(),$scope.undo=!1,$scope.setView("oversikt")},$scope.menuClick=function(r){$scope.show.menu=!1,$scope.paginator=!1,$scope.setView(r.href)},$scope.inbetClear=function(){var ver=$mobile.sell($scope.p);$user.addVer(ver)},$scope.repAvdrag=function(){$mobile.repAvdrag($scope.p)},$scope.save=function(){if("inbet"==$scope.page){{$mobile.inbet($scope.p)}$scope.setView("oversikt")}else if("utbet"==$scope.page){{$mobile.utbet($scope.p)}$scope.setView("oversikt")}else if("overforing"==$scope.page){{$mobile.overforing($scope.p)}$scope.setView("oversikt")}$scope.undo=!0},$scope.setView=function(page){$scope.page=page,"hem"==page?$scope.title="Hem":"inbet"==page?($scope.title="Ny inbetalning",$scope.p=$mobile.getNewPayment()):"utbet"==page?($scope.title="Ny utbetalning",$scope.p=$mobile.getNewPayment()):"overforing"==page?($scope.title="Överföring",$scope.p=$mobile.getNewPayment()):"oversikt"==page?($scope.title="Översikt",$scope.verfikationer=$mobile.oversikt()):"avslut"==page&&($scope.title="Avsluta"),$scope.show.path="/html/mpage/"+page+".html"},$log.info("load"),$scope.undo=!1,$scope.utkassakonton=$mobile.kassakonton,$scope.inkassakonton=$scope.utkassakonton.slice(1,$scope.utkassakonton.length),$scope.invoices=[],$scope.moms=[{typ:25}],$scope.show.menu=!0,$scope.setView("hem"),$scope.rows=[{icon:"fa fa-home ",text:"Hem",href:"hem"},{icon:"fa fa-sign-in ",text:"Inbetalning",href:"inbet"},{icon:"fa fa-sign-out",text:"Utbetalning",href:"utbet"},{icon:"fa fa-exchange",text:"Överföring",href:"overforing"},{icon:"fa fa-eye ",text:"Översikt",href:"oversikt"},{icon:"fa fa-calendar",text:"Avsluta år",href:"avslut"}],$scope.intyp=$mobile.intyp,$scope.uttyp=$mobile.uttyp});var app=angular.module("app");app.controller("momsCtrl",function($scope,$manager,$log,$user){$log.info("init momsCtrl"),$scope.momsperiod=$user.getInfo().momsperiod}),app.service("$moms",function(){var momsTable=[{typ:"a",nr:5,text:"Momspliktig försäljning som inte ingår i ruta 06, 07 eller 08"},{typ:"a",nr:6,text:"Momspliktiga uttag"},{typ:"a",nr:7,text:"Beskattningsunderlag vid vinstmarginalbeskattning"},{typ:"a",nr:8,text:"Hyresinkomster vid frivillig skattskyldighet"},{typ:"b",nr:10,text:"Utgående moms 25%",start:2611,end:2611},{typ:"b",nr:11,text:"Utgående moms 12%",start:2621,end:2611},{typ:"b",nr:12,text:"Utgående moms 6%",start:2631,end:2611},{typ:"c",nr:20,text:"Inköp av varor från ett annat EU-land"},{typ:"c",nr:21,text:"Inköp av tjänster från ett annat EU-land enligt huvudregel"},{typ:"c",nr:22,text:"Inköp av tjänster från ett land utanför EU"},{typ:"c",nr:23,text:"Inköp av varor i Sverige "},{typ:"c",nr:24,text:"Övriga inköp av tjänster "},{typ:"d",nr:30,text:"Utgående moms 25%"},{typ:"d",nr:31,text:"Utgående moms 12%"},{typ:"d",nr:32,text:"Utgående moms 6%"},{typ:"e",nr:35,text:"Försäljning av varor till ett annat EU-land"},{typ:"e",nr:36,text:"Försäljning av varor utanför EU"},{typ:"e",nr:37,text:"Mellanmans inköp av varor vid trepartshande"},{typ:"e",nr:38,text:"Mellanmans försäljning av varor vid trepartshande"},{typ:"e",nr:39,text:"Försäljning av tjänster till näringsidkare i annat EU- land enligt huvudregeln"},{typ:"e",nr:40,text:"Övrig försäljning av tjänster omsatta utanför Sverige"},{typ:"e",nr:41,text:"Försäljning när köparen är skattskyldig i Sverige"},{typ:"e",nr:42,text:"Övrig försäljning m.m"},{typ:"f",nr:48,text:"Ingående moms att dra av",start:2641,end:2641},{typ:"g",nr:49,text:"Moms att betala eller få tillbaka"}];this.calculate=function(start,end,vers){var table=angular.copy(momsTable);return _.each(vers,function(v){start<=new Date($util.sieToDate(v.verdatum))&&new Date($util.sieToDate(v.verdatum)<=end)&&$scope.all.push(v)}),table},this.show=function(){this.calculate(new Date(m.start),new Date(m.end),$user.getVer()),$("#myModal").modal("show")}});var app=angular.module("app");app.controller("neCtrl",function($scope,$manager,$log,$http,$location,$util,$user){$log.info("init neCtrl");var bas=[{sru:"7200",rad:"B1",radText:"Immateriella anläggningstillgångar",konto:"1000",text:"Immateriella anläggningstillgångar",typ:"Anläggningstillgångar"},{sru:"7210",rad:"B2",radText:"Byggnader och markanläggningar",konto:"1110",text:"Byggnader",typ:"Anläggningstillgångar"},{sru:"7210",rad:"B2",radText:"Byggnader och markanläggningar",konto:"1150",text:"Markanläggningar",typ:"Anläggningstillgångar"},{sru:"7211",rad:"B3",radText:"Mark och andra tillgångar som inte får skrivas av",konto:"1130",text:"Mark",typ:"Anläggningstillgångar"},{sru:"7211",rad:"B3",radText:"Mark och andra tillgångar som inte får skrivas av",konto:"1180",text:"Pågående nyanläggningar och förskott för byggnader och mark",typ:"Anläggningstillgångar"},{sru:"7212",rad:"B4",radText:"Maskiner och inventarier",konto:"1220",text:"Maskiner och inventarier",typ:"Anläggningstillgångar"},{sru:"7212",rad:"B4",radText:"Maskiner och inventarier",konto:"1230",text:"Byggnads- och markinventarier",typ:"Anläggningstillgångar"},{sru:"7212",rad:"B4",radText:"Maskiner och inventarier",konto:"1240",text:"Bilar och andra transportmedel",typ:"Anläggningstillgångar"},{sru:"7213",rad:"B5",radText:"Övriga anläggningstillgångar",konto:"1300",text:"Andelar",typ:"Anläggningstillgångar"},{sru:"7240",rad:"B6",radText:"Varulager",konto:"1400",text:"Varulager",typ:"Omsättningstillgångar"},{sru:"7250",rad:"B7",radText:"Kundfordringar",konto:"1500",text:"Kundfordringar",typ:"Omsättningstillgångar"},{sru:"7260",rad:"B8",radText:"Övriga fordringar ",konto:"1600",text:"Övriga fordringar",typ:"Omsättningstillgångar"},{sru:"7260",rad:"B8",radText:"Övriga fordringar ",konto:"1650",text:"Momsfordran",typ:"Omsättningstillgångar"},{sru:"7260",rad:"B8",radText:"Övriga fordringar ",konto:"1700",text:"Förskott till leverantörer",typ:"Omsättningstillgångar"},{sru:"7280",rad:"B9",radText:"Kassa och bank",konto:"1910",text:"Kassa",typ:"Omsättningstillgångar"},{sru:"7280",rad:"B9",radText:"Kassa och bank",konto:"1920",text:"PlusGiro",typ:"Omsättningstillgångar"},{sru:"7280",rad:"B9",radText:"Kassa och bank",konto:"1930",text:"Företagskonto/checkkonto/affärskonto",typ:"Omsättningstillgångar"},{sru:"7280",rad:"B9",radText:"Kassa och bank",konto:"1940",text:"Övriga bankkonton",typ:"Omsättningstillgångar"},{sru:"7280",rad:"B9",radText:"Kassa och bank",konto:"1970",text:"Särskilda bankkonton",typ:"Omsättningstillgångar"},{sru:"7280",rad:"B9",radText:"Kassa och bank",konto:"1970",text:"Särskilda bankkonton",typ:"Omsättningstillgångar"},{sru:"7300",rad:"B10",radText:"Eget kapital",konto:"2010",text:"Eget kapital, delägare 1",typ:"Eget kapital"},{sru:"7300",rad:"B10",radText:"Eget kapital",konto:"2020–2040",text:"Eget kapital, delägare 2–4",typ:"Eget kapital"},{sru:"7380",rad:"B13",radText:"Låneskulder",konto:"2330",text:"Checkräkningskredit",typ:"Skulder"},{sru:"7380",rad:"B13",radText:"Låneskulder",konto:"2350",text:"Skulder till kreditinstitut",typ:"Skulder"},{sru:"7380",rad:"B13",radText:"Låneskulder",konto:"2390",text:"Övriga låneskulder",typ:"Skulder"},{sru:"7381",rad:"B14",radText:"Skatteskulder",konto:"2610",text:"Utgående moms, oreducerad",typ:"Skulder"},{sru:"7381",rad:"B14",radText:"Skatteskulder",konto:"2620",text:"Utgående moms, reducerad 1",typ:"Skulder"},{sru:"7381",rad:"B14",radText:"Skatteskulder",konto:"2630",text:"Utgående moms, reducerad 2",typ:"Skulder"},{sru:"7381",rad:"B14",radText:"Skatteskulder",konto:"2640",text:"Ingående moms",typ:"Skulder"},{sru:"7381",rad:"B14",radText:"Skatteskulder",konto:"2650",text:"Redovisningskonto för moms",typ:"Skulder"},{sru:"7381",rad:"B14",radText:"Skatteskulder",konto:"2660",text:"Särskilda punktskatter",typ:"Skulder"},{sru:"7381",rad:"B14",radText:"Skatteskulder",konto:"2710",text:"Personalskatt",typ:"Skulder"},{sru:"7381",rad:"B14",radText:"Skatteskulder",konto:"2730",text:"Lagstadgade/avtalade sociala avgifter och särskild löneskatt",typ:"Skulder"},{sru:"7382",rad:"B15",radText:"Leverantörsskulder",konto:"2440",text:"Leverantörsskulder",typ:"Skulder"},{sru:"7383",rad:"B16",radText:"Övriga skulder",konto:"2900",text:"Övriga skulder",typ:"Skulder"},{sru:"7400",rad:"R1",radText:"Försäljning och utfört arbete samt övriga momspliktiga intäkter",konto:"3000",text:"Försäljning och utfört arbete samt övriga momspliktiga inkomster",typ:"Intäkter"},{sru:"7400",rad:"R1",radText:"Försäljning och utfört arbete samt övriga momspliktiga intäkter",konto:"3500",text:"Fakturerade kostnader",typ:"Intäkter"},{sru:"7400",rad:"R1",radText:"Försäljning och utfört arbete samt övriga momspliktiga intäkter",konto:"3700",text:"Lämnade rabatter, bonusar etc. R1/R2",typ:"Intäkter"},{sru:"7400",rad:"R1",radText:"Försäljning och utfört arbete samt övriga momspliktiga intäkter",konto:"3900",text:"Övriga rörelseintäkter R1/R2",typ:"Intäkter"},{sru:"7401",rad:"R2 ",radText:"Momsfria intäkter",konto:"3100",text:"Momsfria intäkter",typ:"Intäkter"},{sru:"7401",rad:"R2 ",radText:"Momsfria intäkter",konto:"3700",text:"Lämnade rabatter, bonusar etc. R1/R2",typ:"Intäkter"},{sru:"7401",rad:"R2 ",radText:"Momsfria intäkter",konto:"3900",text:"Övriga rörelseintäkter R1/R2",typ:"Intäkter"},{sru:"7401",rad:"R2 ",radText:"Momsfria intäkter",konto:"3970",text:"Vinst vid avyttring av immateriella och materiella anläggningstillgångar",typ:"Intäkter"},{sru:"7401",rad:"R2 ",radText:"Momsfria intäkter",konto:"3980",text:"Erhållna bidrag",typ:"Intäkter"},{sru:"7402",rad:"R3 ",radText:"Bil- och bostadsförmån m.m.",konto:"3200",text:"Bil- och bostadsförmån m.m.",typ:"Intäkter"},{sru:"7403",rad:"R4 ",radText:"Ränteintäkter m.m.",konto:"8310",text:"Ränteintäkter och utdelningar",typ:"Intäkter"},{sru:"7403",rad:"R4 ",radText:"Ränteintäkter m.m.",konto:"8330",text:"Valutakursdifferenser på fordringar och placeringar",typ:"Intäkter"},{sru:"7500",rad:"R5",radText:"Varor, material och tjänster",konto:"4000",text:"Varor",typ:"Kostnader"},{sru:"7500",rad:"R5",radText:"Varor, material och tjänster",konto:"4600",text:"Legoarbeten och underentreprenader",typ:"Kostnader"},{sru:"7500",rad:"R5",radText:"Varor, material och tjänster",konto:"4700",text:"Erhållna rabatter, bonus etc.",typ:"Kostnader"},{sru:"7500",rad:"R5",radText:"Varor, material och tjänster",konto:"4900",text:"Förändring av lager",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"5000",text:"Lokalkostnader",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"5100",text:"Fastighetskostnader",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"5200",text:"Hyra av anläggningstillgångar",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"5400",text:"Förbrukningsinventarier och förbruk ningsmaterial",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"5500",text:"Reparation och underhåll",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"5600",text:"Kostnader för transportmedel",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"5610",text:"Personbilskostnader",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"5620",text:"Lastbilskostnader",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"5700",text:"Frakter och transporter",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"5800",text:"Resekostnader",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"5900",text:"Reklam och PR",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"6000",text:"Övriga försäljningskostnader",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"6070",text:"Representation",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"6100",text:"Kontorsmateriel och trycksaker",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"6200",text:"Tele och post",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"6300",text:"Företagsförsäkringar",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"6310",text:"Företagsförsäkringar och övriga riskkostnader",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"6500",text:"Övriga externa tjänster",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"6800",text:"Inhyrd personal",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"6900",text:"Övriga kostnader",typ:"Kostnader"},{sru:"7501",rad:"R6",radText:"Övriga externa kostnader",konto:"6980",text:"Föreningsavgifter",typ:"Kostnader"},{sru:"7502",rad:"R7",radText:"Anställd personal",konto:"7000",text:"Löner till anställda",typ:"Kostnader"},{sru:"7502",rad:"R7",radText:"Anställd personal",konto:"7300",text:"Kostnadsersättningar och förmåner",typ:"Kostnader"},{sru:"7502",rad:"R7",radText:"Anställd personal",konto:"7400",text:"Pensionskostnader",typ:"Kostnader"},{sru:"7502",rad:"R7",radText:"Anställd personal",konto:"7500",text:"Sociala och andra avgifter enligt lag och avtal",typ:"Kostnader"},{sru:"7502",rad:"R7",radText:"Anställd personal",konto:"7600",text:"Övriga personalkostnader",typ:"Kostnader"},{sru:"7503",rad:"R8",radText:"Räntekostnader m.m.",konto:"8410",text:"Räntekostnader för skulder",typ:"Kostnader"},{sru:"7503",rad:"R8",radText:"Räntekostnader m.m.",konto:"8430",text:"Valutakursdifferenser på skulder",typ:"Kostnader"},{sru:"7504",rad:"R9",radText:"Avskrivningar och nedskrivningar byggnader och markanläggningar",konto:"7700",text:"Nedskrivningar R9/R10",typ:"Avskrivningar"},{sru:"7504",rad:"R9",radText:"",konto:"7820",text:"Avskrivningar på byggnader och markanläggningar",typ:"Avskrivningar"},{sru:"7504",rad:"R9",radText:"",konto:"7980",text:"Ersättningsfonder R9/R10",typ:"Avskrivningar"},{sru:"7505",rad:"R10",radText:"Avskrivningar och nedskrivningar maskiner och inventarier och immateriella tillgångar",konto:"7810",text:"Avskrivningar på immateriella anläggningstillgångar",typ:"Avskrivningar"},{sru:"7505",rad:"R10",radText:"Avskrivningar och nedskrivningar maskiner och inventarier och immateriella tillgångar",konto:"7830",text:"Avskrivningar på maskiner och inventarier",typ:"Avskrivningar"},{sru:"7505",rad:"R10",radText:"Avskrivningar och nedskrivningar maskiner och inventarier och immateriella tillgångar",konto:"7980",text:"Ersättningsfonder R9/R10",typ:"Avskrivningar"},{sru:"7440",rad:"R11",radText:"Bokfört resultat ",konto:"8990",text:"Resultat",typ:"Årets resultat"}];
_.each($user.getVer(),function(v){_.each(v.poster,function(a){var sru=_.findWhere(bas,{konto:a.kontonr});sru&&(sru.saldo||(sru.saldo=0),sru.saldo+=Math.abs(a.belopp))})}),$scope.b1=_.uniq(_.where(bas,{typ:"Anläggningstillgångar"}),function(item){return item.rad}),$scope.b6=_.uniq(_.where(bas,{typ:"Omsättningstillgångar"}),function(item){return item.rad}),$scope.b10=_.uniq(_.where(bas,{typ:"Eget kapital"}),function(item){return item.rad}),$scope.b13=_.uniq(_.where(bas,{typ:"Skulder"}),function(item){return item.rad}),$scope.r1=_.uniq(_.where(bas,{typ:"Intäkter"}),function(item){return item.rad}),$scope.r5=_.uniq(_.where(bas,{typ:"Kostnader"}),function(item){return item.rad}),$scope.r9=_.uniq(_.where(bas,{typ:"Avskrivningar"}),function(item){return item.rad}),$scope.r11=_.uniq(_.where(bas,{typ:"Årets resultat"}),function(item){return item.rad})});var app=angular.module("app");app.controller("overviewCtrl",function($scope,$filter,$http,$user,$util,$location,$manager,$log,sharedObject){$log.info("init overviewCtrl"),$scope.init=function(){$scope.konton=$user.getKonton(),$scope.series=$user.getInfo().series,$scope.uploadme={},$util.started||($util.started=!0,$user.getDBmail().then(function(dbMail){$scope.dbMail=dbMail,$http.get("/api/haveuser?email="+dbMail).then(function(){},function(){$("#myModal").modal("show")})})),$util.isOldBrowser()&&$util.error("","Du verkar använda en äldre web läsare ledgerbox fungerar bäst med Chrome eller Firefox.")},$scope.create=function(){$http.get("/api/create?name="+$scope.name+"&company="+$scope.company+"&dbMail="+$scope.dbMail+"&email="+$scope.email+"&tel="+$scope.tele),$("#myModal").modal("hide")},$scope.label=function(nr,name){return nr+" ("+name+")"},$scope.show=function(v){sharedObject.setv(v.id,v),$location.path("/desktop/bookkeeping/show/"+v.id)},$scope.revert=function(v){sharedObject.setv(v.id,v),$location.path("/desktop/bookkeeping/revert/"+v.id)},$scope.search=function(v){var vDate=new Date($filter("siedate")(v.ver.verdatum)),search=$scope.g.search;if(search.freeText&&JSON.stringify(v.ver).toLowerCase().indexOf($scope.g.search.freeText.trim().toLowerCase())<0)return!1;if(search.konto){var w=_.where(v.ver.poster,{kontonr:search.konto.kontonr});if(!w.length)return!1}return search.startDate&&new Date(search.startDate)>vDate?!1:search.endDate&&new Date(search.endDate)<vDate?!1:search.serie&&search.serie.namn!=v.ver.serie?!1:!0},$scope.verfikationer=[],_.each($user.getVer(),function(v){var extra={};extra.date=new Date($filter("siedate")(v.verdatum)).getTime(),extra.dateString=$util.sieToDate(v.verdatum),extra.vernr=parseInt(v.vernr),extra.text=$util.getVerNameText(v.vertext),extra.files=$util.getVerNameFiles(v.vertext),extra.sum=$util.sumBelopp(v),extra.sumFixed=$util.toFixed(extra.sum),extra.ver=v,$scope.verfikationer.push(extra)})});var app=angular.module("app");app.controller("rawCtrl",function($scope,$manager,$log,$user){$log.info("init rawCtrl"),$scope.load=function(){$scope.all=$user.poster}});var app=angular.module("app");app.controller("reportsCtrl",function(){$log.info("init reportsCtrl")});var app=angular.module("app");app.controller("resultatCtrl",function($scope,$log,$user,$util){function calculate(start,end){var all=[];return start=new Date(start),end=new Date(end),_.each($user.getVer(),function(v){var date=new Date($util.sieToDate(v.verdatum));date>=start&&end>=date&&_.each(v.poster,function(p){var k=_.findWhere(all,{kontonr:p.kontonr});k?k.belopp+=p.belopp:all.push({text:$user.getKontoNamn(p.kontonr),kontonr:p.kontonr,belopp:p.belopp})})}),all}$log.info("init resultatCtrl"),$scope.bas=[{typ:"sub",title:"Nettoomsättning",start:3e3,end:3899},{typ:"sub",title:"Övriga rörelseintäkter",start:3900,end:3999},{typ:"head",title:"Rörelsens intäkter",sum:[{start:3e3,end:3999}]},{typ:"sub",title:"Material och varor",start:4e3,end:4960},{typ:"head",title:"Bruttovinst",sum:[{start:3e3,end:3999},{start:4e3,end:4999}]},{typ:"sub",title:"Övriga externa kostnader",start:5e3,end:6999},{typ:"sub",title:"Personalkostnader",start:7e3,end:7699},{typ:"head",title:"Rörelsens kostnader",sum:[{start:5e3,end:7799}]},{typ:"head",title:"Rörelseresultat före avskrivningar",sum:[{start:3e3,end:3999},{start:4e3,end:7799}]},{typ:"sub",title:"Avskrivningar",start:7820,end:7899},{typ:"head",title:"Rörelseresultat efter avskrivningar",sum:[{start:3e3,end:3999},{start:4e3,end:7899}]},{typ:"sub",title:"Finansiella intäkter och kostnader",start:8300,end:8499},{typ:"head",title:"Resultat efter finansiella poster",sum:[{start:3e3,end:3999},{start:4e3,end:8499}]},{typ:"sub",title:"Bokslutsdispositioner",start:8800,end:8850},{typ:"head",title:"Resultat efter bokslutsdispositioner",sum:[{start:3e3,end:3999},{start:4e3,end:8850}]},{typ:"sub",title:"Skatt",start:8910,end:8910},{typ:"head",title:"Årets resultat",sum:[{start:3e3,end:3999},{start:4e3,end:8899}]}],$scope.newDate=function(){$scope.result=$scope.resultatrapport($scope.search.startDate,$scope.search.endDate)},$scope.resultatrapport=function result(start,end){return $scope.all=calculate(start,end),_.each($scope.bas,function(b){b.belopp=0,b.konton=[],_.each($scope.all,function(a){"sub"==b.typ&&b.start<a.kontonr&&a.kontonr<b.end&&(b.konton.push(a),b.belopp+=a.belopp),"head"==b.typ&&b.sum[0].start<a.kontonr&&a.kontonr<b.sum[0].end&&(b.belopp+=a.belopp),"head"==b.typ&&2==b.sum.length&&b.sum[1].start<a.kontonr&&a.kontonr<b.sum[1].end&&(b.belopp+=a.belopp)})}),result},$scope.search={};var book=$user.getBook();$scope.search.startDate=$util.sieToDate(angular.copy(book.start)),$scope.search.endDate=$util.sieToDate(angular.copy(book.slut)),$scope.resultatrapport($scope.search.startDate,$scope.search.endDate)});var app=angular.module("app");app.controller("settingCtrl",function($scope,$http,$location,$util,$user){$scope.show={},$scope.show.info=!0,$scope.show.addSerie=!1,$scope.show.konto=!1,$scope.common={},$scope.info=$user.getInfo(),$scope.logo=$user.getLogo(),$scope.konton=_.where($user.poster,{etikett:"konto"}),$scope.series=$scope.info.series,$scope.moms=$user.getInfo().moms,$scope.deleteKonto=function(idx){var konto=$scope.konton[idx];$user.deletePost(konto),$scope.konton.splice(idx,1)},$scope.deleteSerie=function(idx){$scope.info.series.splice(idx,1),$user.update($user.getInfo())},$scope.addSerie=function(){if($scope.serieName&&$scope.serieInfo){var s={namn:$scope.serieName,info:$scope.serieInfo};$scope.info.series.push(s),$scope.show.addSerie=!1}},$scope.addKonto=function(){if($scope.kontonamn&&$scope.kontonr){var s={kontonamn:$scope.kontonamn,kontonr:$scope.kontonr,etikett:"konto"};$user.addKonto(s),$scope.konton=_.where($user.poster,{etikett:"konto"}),$scope.show.addKonto=!1}},$scope.save=function(){$user.update($scope.info),$user.update($scope.logo),_.each($scope.konton,function(a){$user.update(a)})},$scope.changeMoms=function(){$user.update($user.getInfo())}});var app=angular.module("app");app.controller("sieCtrl",function($scope,$manager,$log,$http,$location,$util,$user){$log.info("init sieCtrl"),$scope.done=function(res){$manager.uploadSie(res),$scope.getBooks()},$scope.getBooks=function(){$scope.rows=[];var books=$user.getBooks(),aktiv=$user.getInfo().aktiv;_.each(books,function(b){var row={};row.start=$util.sieToDate(b.start),row.slut=$util.sieToDate(b.slut),row.ver=$user.getVerByBook(b).length,row.book=b,aktiv==b.id&&(row.aktiv=!0),$scope.rows.push(row)})},$scope.active=function(b){$user.activeBook(b.book),$scope.getBooks()},$scope.viewSIE=function(b){$scope.sieText=$manager.getSieFile(b.book),$("#sieModal").modal()},$scope.remove=function(idx,b){var r=confirm("Vill du ta bort boken");1==r&&($user.removeBook(b.book),$scope.rows.splice(idx,1))},$scope.downloadSIE=function(b){$util.downloadSIE(b)},$scope.getBooks()});var app=angular.module("app");app.controller("testCtrl",function($scope,$manager,$log,$util){$log.info("init test"),$scope.init=function(){$scope.test=[],$scope.test.push({name:"1",result:$scope.test1()}),$scope.test.push({name:"1",result:$scope.test2()}),$scope.test.push({name:"1",result:$scope.test3()})},$scope.test1=function(){return $.get("/js/test/sie/prova.js",function(data){var file=$util.sieToString($util.str2ab(data)),json=parserService.sieToJson(file),vers=_.where(json.poster,{etikett:"ver"}),table=$result.calculate(new Date("2010-01-01"),new Date("2010-12-31"),vers),i=_.findWhere(table,{kontonr:3010});equal(i.belopp,6398286,"");var i=_.findWhere(table,{kontonr:3021});equal(i.belopp,1824736,""),i=_.findWhere(table,{nr:10}),equal(i.belopp,6899206,""),i=_.findWhere(table,{nr:11}),equal(i.belopp,85,""),i=_.findWhere(table,{nr:48}),equal(i.belopp,-2092545,""),i=_.findWhere(table,{nr:49}),equal(i.belopp,1309723,""),start()}),!0},$scope.test2=function(){return!0},$scope.test3=function(){}});